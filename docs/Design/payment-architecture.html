<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayoneX ‚Äî Enterprise Payment Processing Platform</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%2306070b'/><text x='16' y='22' font-family='system-ui' font-size='16' font-weight='900' text-anchor='middle' fill='%233b82f6'>PX</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--bg:#08090d;--bg2:#0f1118;--bg3:#151822;--bg4:#1a1e2e;--bdr:#1f2438;--bdr2:#2a3050;--t1:#e8eaf0;--t2:#8b90a0;--t3:#555a6e;--blue:#3b82f6;--cyan:#06b6d4;--green:#10b981;--amber:#f59e0b;--rose:#f43f5e;--violet:#8b5cf6;--orange:#f97316;--kafka:#e8523f;--r:10px;--tr:0.3s cubic-bezier(0.4,0,0.2,1);--fd:'Outfit',sans-serif;--fm:'JetBrains Mono',monospace}
*{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}
body{font-family:var(--fd);background:var(--bg);color:var(--t1);line-height:1.65;overflow-x:hidden}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--bdr2);border-radius:3px}
.bgx{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(59,130,246,.08),transparent),radial-gradient(circle at 20% 80%,rgba(139,92,246,.05),transparent),linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:100%,100%,60px 60px,60px 60px}
.c{max-width:1400px;margin:0 auto;padding:0 32px;position:relative;z-index:1}
.hdr{padding:48px 0 32px;border-bottom:1px solid var(--bdr)}
.hdr-b{display:inline-flex;align-items:center;gap:8px;padding:6px 14px;border-radius:20px;background:rgba(59,130,246,.15);border:1px solid rgba(59,130,246,.2);font-size:12px;font-weight:600;color:var(--blue);text-transform:uppercase;letter-spacing:1.5px;font-family:var(--fm);margin-bottom:20px}
.hdr-b::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--blue);box-shadow:0 0 8px var(--blue);animation:pd 2s ease-in-out infinite}
@keyframes pd{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
.hdr h1{font-size:clamp(42px,5vw,64px);font-weight:900;letter-spacing:-2px;line-height:1.1;background:linear-gradient(135deg,#fff 0%,var(--blue) 50%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 25px rgba(59,130,246,.25));position:relative;width:fit-content}
.hdr h1::before{content:'';position:absolute;bottom:-6px;left:0;width:100%;height:2px;background:var(--bdr);border-radius:2px}
.hdr h1::after{content:'';position:absolute;bottom:-10px;right:-2px;width:10px;height:10px;border-radius:50%;background:var(--cyan);box-shadow:0 0 10px var(--cyan),0 0 20px rgba(6,182,212,.4);animation:hdr-glow 2s ease-in-out infinite alternate}
@keyframes hdr-glow{0%{box-shadow:0 0 8px var(--cyan),0 0 16px rgba(6,182,212,.3)}100%{box-shadow:0 0 14px var(--cyan),0 0 28px rgba(6,182,212,.5)}}
.hdr-sub{font-size:14px;color:var(--t3);letter-spacing:4px;text-transform:uppercase;font-weight:500;margin-top:16px;font-family:var(--fm)}
.hdr-s{font-size:17px;color:var(--t2);margin-top:16px;max-width:700px}
.hdr-m{display:flex;gap:24px;margin-top:20px;flex-wrap:wrap}
.hdr-m span{font-size:13px;font-family:var(--fm);color:var(--t3);display:flex;align-items:center;gap:6px}
.hdr-m span::before{content:'';width:4px;height:4px;border-radius:50%}
.m1::before{background:var(--kafka)}.m2::before{background:var(--cyan)}.m3::before{background:var(--green)}.m4::before{background:var(--violet)}
nav{position:sticky;top:0;z-index:100;background:rgba(8,9,13,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--bdr);padding:0 32px}
.ni{max-width:1400px;margin:0 auto;display:flex;gap:4px;overflow-x:auto;padding:8px 0;-ms-overflow-style:none;scrollbar-width:none}
.ni::-webkit-scrollbar{display:none}
.nb{flex-shrink:0;padding:8px 14px;border-radius:8px;background:0;border:0;color:var(--t2);font-size:12px;font-family:var(--fd);font-weight:500;cursor:pointer;transition:var(--tr);white-space:nowrap}
.nb:hover{color:var(--t1);background:var(--bg4)}.nb.a{color:var(--blue);background:rgba(59,130,246,.15)}
section{padding:48px 0}
.sl{font-size:11px;font-family:var(--fm);color:var(--t3);text-transform:uppercase;letter-spacing:2.5px;font-weight:600;margin-bottom:8px}
.st{font-size:clamp(24px,3vw,34px);font-weight:700;letter-spacing:-.5px;margin-bottom:16px}
.sd{font-size:15px;color:var(--t2);max-width:800px;margin-bottom:32px;line-height:1.7}
.g2{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:16px}
.g3{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
.g4{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.g5{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.card{background:var(--bg3);border:1px solid var(--bdr);border-radius:var(--r);padding:20px;transition:var(--tr)}
.card:hover{border-color:var(--bdr2);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.3)}
.card h4{font-size:15px;font-weight:700;margin-bottom:4px}.card p{font-size:13px;color:var(--t2);line-height:1.7;margin-top:6px}
.tag{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-family:var(--fm);background:var(--bg4);color:var(--t2);border:1px solid var(--bdr);font-weight:500;margin:2px}
.tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:10px}
.mono{font-family:var(--fm);font-size:12px}
.dim{color:var(--t3)}.sec{color:var(--t2)}
.blu{color:var(--blue)}.cyn{color:var(--cyan)}.grn{color:var(--green)}.amb{color:var(--amber)}.ros{color:var(--rose)}.vio{color:var(--violet)}.org{color:var(--orange)}.kaf{color:var(--kafka)}
.ico{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.callout{background:var(--bg2);border:1px solid var(--bdr);border-left:3px solid var(--blue);border-radius:var(--r);padding:20px 24px;margin:20px 0}
.callout h4{font-size:14px;font-weight:700;margin-bottom:6px;color:var(--blue)}.callout p{font-size:13px;color:var(--t2);line-height:1.7}
.callout.ck{border-left-color:var(--kafka)}.callout.ck h4{color:var(--kafka)}
.callout.ca{border-left-color:var(--amber)}.callout.ca h4{color:var(--amber)}
.callout.cg{border-left-color:var(--green)}.callout.cg h4{color:var(--green)}
.callout.cv{border-left-color:var(--violet)}.callout.cv h4{color:var(--violet)}
table{width:100%;border-collapse:separate;border-spacing:0;border-radius:var(--r);overflow:hidden;border:1px solid var(--bdr);font-size:13px;margin:16px 0}
th{background:var(--bg4);padding:10px 14px;text-align:left;font-size:11px;font-family:var(--fm);color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;font-weight:600;border-bottom:1px solid var(--bdr)}
td{padding:10px 14px;border-bottom:1px solid var(--bdr);color:var(--t2)}
tr:last-child td{border-bottom:0}tr:hover{background:rgba(255,255,255,.02)}
.badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-family:var(--fm);font-weight:600}
.bb{background:rgba(59,130,246,.15);color:var(--blue)}.bg{background:rgba(16,185,129,.15);color:var(--green)}.ba{background:rgba(245,158,11,.15);color:var(--amber)}.bv{background:rgba(139,92,246,.15);color:var(--violet)}.br{background:rgba(244,63,94,.15);color:var(--rose)}.bk{background:rgba(232,82,63,.15);color:var(--kafka)}
.sla-v{font-size:28px;font-weight:800;font-family:var(--fm);letter-spacing:-1px;text-align:center}
.kb{margin:14px 0;padding:10px 24px;background:linear-gradient(90deg,transparent 0%,rgba(232,82,63,.12) 15%,rgba(232,82,63,.12) 85%,transparent 100%);border-top:1px solid rgba(232,82,63,.2);border-bottom:1px solid rgba(232,82,63,.2);text-align:center;font-size:11px;font-family:var(--fm);color:var(--kafka);font-weight:600;letter-spacing:2px;position:relative;overflow:hidden}
.kb::before{content:'';position:absolute;top:50%;left:-100%;width:200%;height:1px;background:linear-gradient(90deg,transparent,var(--kafka),transparent);animation:ks 4s linear infinite}
@keyframes ks{0%{transform:translateX(-50%)}100%{transform:translateX(0%)}}
.kt{display:inline-block;padding:2px 10px;background:rgba(232,82,63,.1);border-radius:4px;margin:0 4px;font-size:11px}
.flow-box{background:var(--bg2);border:1px solid var(--bdr);border-radius:16px;padding:32px;overflow-x:auto;position:relative}
.flow-box::before{content:attr(data-label);position:absolute;top:14px;left:22px;font-size:10px;font-family:var(--fm);color:var(--t3);letter-spacing:2px;font-weight:600}
.fn{position:relative;min-width:130px;padding:12px 16px;border-radius:var(--r);text-align:center;font-size:12px;font-weight:600;transition:var(--tr);border:1px solid;display:inline-block;margin:4px}
.fn:hover{transform:translateY(-2px)}
.fn .ni2{font-size:9px;font-family:var(--fm);opacity:.6;letter-spacing:1px;margin-bottom:3px}
.fn .nl{font-size:13px;font-weight:600}.fn .ns{font-size:10px;font-weight:400;opacity:.7;margin-top:2px}
.n-bl{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.3);color:var(--blue)}
.n-cy{background:rgba(6,182,212,.12);border-color:rgba(6,182,212,.3);color:var(--cyan)}
.n-am{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.3);color:var(--amber)}
.n-gn{background:rgba(16,185,129,.12);border-color:rgba(16,185,129,.3);color:var(--green)}
.n-vi{background:rgba(139,92,246,.12);border-color:rgba(139,92,246,.3);color:var(--violet)}
.n-ro{background:rgba(244,63,94,.12);border-color:rgba(244,63,94,.3);color:var(--rose)}
.n-ex{background:rgba(255,255,255,.03);border-color:var(--bdr2);border-style:dashed;color:var(--t2)}
.n-kf{background:rgba(232,82,63,.12);border-color:rgba(232,82,63,.35);color:var(--kafka)}
.arr{display:inline-block;color:var(--t3);font-size:16px;margin:0 4px;vertical-align:middle}
.spec{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:10px}
.spec-i{font-size:11px;font-family:var(--fm);color:var(--t3);padding:6px 10px;background:var(--bg4);border-radius:6px}
.spec-i strong{display:block;color:var(--t2);font-size:13px}
.stripe{background:var(--bg3);border-left:3px solid;padding:14px 18px;border-radius:0 var(--r) var(--r) 0;margin:6px 0}
.stripe h4{font-size:14px;font-weight:600;margin-bottom:3px}.stripe p{font-size:12.5px;color:var(--t2);line-height:1.6}
.footer{padding:40px 0;border-top:1px solid var(--bdr);text-align:center;color:var(--t3);font-size:12px;font-family:var(--fm)}
@media(max-width:768px){.c{padding:0 16px}.g2,.g3,.g4,.g5{grid-template-columns:1fr}.flow-box{padding:16px}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COLLAPSIBLE METRO MAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.collapse-trigger{display:flex;align-items:center;gap:10px;padding:12px 18px;border-radius:var(--r);border:1px solid var(--bdr);background:var(--bg3);color:var(--t2);font-size:13px;font-family:var(--fd);font-weight:600;cursor:pointer;transition:var(--tr);width:100%;text-align:left;margin-top:16px}
.collapse-trigger:hover{border-color:var(--bdr2);color:var(--t1);background:var(--bg4)}
.collapse-trigger .chevron{transition:transform .3s;font-size:10px;color:var(--blue);flex-shrink:0}
.collapse-trigger.open .chevron{transform:rotate(90deg)}
.collapse-trigger .ct-badge{font-size:9px;font-family:var(--fm);padding:2px 8px;border-radius:4px;background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);color:var(--blue);letter-spacing:1px;font-weight:700}
.collapse-body{max-height:0;overflow:hidden;transition:max-height .5s ease}
.collapse-body.open{max-height:6000px}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê METRO MAP (scoped under .mm) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.mm{position:relative;padding:0 0 20px;max-width:680px;margin:0 auto}
.mm .mm-trunk{position:absolute;left:120px;top:12px;bottom:140px;width:5px;background:linear-gradient(180deg,transparent 0%,var(--blue) 2%,var(--blue) 98%,transparent 100%);border-radius:3px;z-index:1;overflow:hidden}
.mm .mm-trunk::before{content:'';position:absolute;left:0;top:0;width:100%;height:80px;background:linear-gradient(180deg,transparent,rgba(59,130,246,.6),transparent);border-radius:3px;animation:mm-pulse 4s ease-in-out infinite}
@keyframes mm-pulse{0%{top:-80px;opacity:0}10%{opacity:1}90%{opacity:1}100%{top:calc(100% - 80px);opacity:0}}

.mm .mm-st{position:relative;padding-left:170px;padding-right:24px;margin-bottom:0;min-height:80px;display:flex;align-items:flex-start;z-index:2}
.mm .mm-dot{position:absolute;left:110px;top:12px;width:22px;height:22px;border-radius:50%;border:3px solid var(--blue);background:var(--bg);z-index:3;transition:all .3s}
.mm .mm-st:hover .mm-dot{transform:scale(1.15);box-shadow:0 0 12px rgba(59,130,246,.3)}
.mm .mm-card{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r);padding:16px 20px;width:100%;position:relative;transition:border-color .3s,box-shadow .3s}
.mm .mm-card:hover{border-color:var(--bdr2);box-shadow:0 4px 24px rgba(0,0,0,.3)}
.mm .mm-card .mm-tier{font-size:10px;font-family:var(--fm);font-weight:600;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px}
.mm .mm-card h3{font-size:16px;font-weight:700;letter-spacing:-.3px;margin-bottom:8px;color:var(--t1)}
.mm .mm-card .mm-desc{font-size:13px;color:var(--t2);line-height:1.6;margin-bottom:6px}
.mm .mm-card .mm-tech{font-size:11px;font-family:var(--fm);color:var(--t3);line-height:1.6}
.mm .mm-st::before{content:'';position:absolute;left:132px;top:22px;width:38px;height:2px;z-index:2}

/* Station color variants */
.mm .mm-st.ext .mm-dot{border-color:var(--t3);border-style:dashed}
.mm .mm-st.ext::before{background:var(--t3)}.mm .mm-st.ext .mm-tier{color:var(--t3)}
.mm .mm-st.s-blue .mm-dot{border-color:var(--blue)}.mm .mm-st.s-blue::before{background:var(--blue)}.mm .mm-st.s-blue .mm-tier{color:var(--blue)}
.mm .mm-st.s-cyan .mm-dot{border-color:var(--cyan)}.mm .mm-st.s-cyan::before{background:var(--cyan)}.mm .mm-st.s-cyan .mm-tier{color:var(--cyan)}
.mm .mm-st.s-amber .mm-dot{border-color:var(--amber)}.mm .mm-st.s-amber::before{background:var(--amber)}.mm .mm-st.s-amber .mm-tier{color:var(--amber)}
.mm .mm-st.s-green .mm-dot{border-color:var(--green)}.mm .mm-st.s-green::before{background:var(--green)}.mm .mm-st.s-green .mm-tier{color:var(--green)}
.mm .mm-st.s-violet .mm-dot{border-color:var(--violet)}.mm .mm-st.s-violet::before{background:var(--violet)}.mm .mm-st.s-violet .mm-tier{color:var(--violet)}
.mm .mm-st.s-rose .mm-dot{border-color:var(--rose)}.mm .mm-st.s-rose::before{background:var(--rose)}.mm .mm-st.s-rose .mm-tier{color:var(--rose)}

/* Special glowing stations */
.mm .mm-st.sp-green .mm-dot{border-color:var(--green);box-shadow:0 0 16px rgba(16,185,129,.5),0 0 32px rgba(16,185,129,.2);animation:mm-glow-g 2s ease-in-out infinite alternate;display:flex;align-items:center;justify-content:center}
.mm .mm-st.sp-green .mm-dot .dot-icon{font-size:12px;line-height:1;filter:drop-shadow(0 0 4px rgba(16,185,129,.8))}
.mm .mm-st.sp-green::before{background:var(--green)}.mm .mm-st.sp-green .mm-tier{color:var(--green)}
.mm .mm-st.sp-green .mm-card{border-color:rgba(16,185,129,.3);background:linear-gradient(135deg,var(--bg2),rgba(16,185,129,.05))}
@keyframes mm-glow-g{0%{box-shadow:0 0 12px rgba(16,185,129,.4),0 0 24px rgba(16,185,129,.15)}100%{box-shadow:0 0 20px rgba(16,185,129,.6),0 0 40px rgba(16,185,129,.25)}}

.mm .mm-st.sp-cyan .mm-dot{border-color:var(--cyan);box-shadow:0 0 16px rgba(6,182,212,.5),0 0 32px rgba(6,182,212,.2);animation:mm-glow-c 2s ease-in-out infinite alternate;display:flex;align-items:center;justify-content:center}
.mm .mm-st.sp-cyan .mm-dot .dot-icon{font-size:12px;line-height:1;filter:drop-shadow(0 0 4px rgba(6,182,212,.8))}
.mm .mm-st.sp-cyan::before{background:var(--cyan)}.mm .mm-st.sp-cyan .mm-tier{color:var(--cyan)}
.mm .mm-st.sp-cyan .mm-card{border-color:rgba(6,182,212,.3);background:linear-gradient(135deg,var(--bg2),rgba(6,182,212,.05))}
@keyframes mm-glow-c{0%{box-shadow:0 0 12px rgba(6,182,212,.4),0 0 24px rgba(6,182,212,.15)}100%{box-shadow:0 0 20px rgba(6,182,212,.6),0 0 40px rgba(6,182,212,.25)}}

/* Kafka interchange */
.mm .mm-kafka{position:relative;padding-left:170px;margin:0;height:56px;display:flex;align-items:center;z-index:2}
.mm .mm-kafka .mk-dot{position:absolute;left:114px;top:50%;transform:translateY(-50%);width:14px;height:14px;border-radius:3px;rotate:45deg;background:var(--kafka);z-index:3;box-shadow:0 0 8px rgba(232,82,63,.3)}
.mm .mm-kafka .mk-label{font-size:11px;font-family:var(--fm);color:var(--kafka);font-weight:600;display:flex;align-items:center;gap:8px}
.mm .mm-kafka .mk-label::before{content:'KAFKA';font-size:8px;font-weight:700;letter-spacing:1px;padding:2px 6px;border-radius:3px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.2)}
.mm .mm-kafka .mk-conn{position:absolute;left:132px;top:50%;width:38px;height:2px;background:var(--kafka);z-index:2}

/* MQ interchange */
.mm .mm-mq{position:relative;padding-left:170px;margin:0;height:56px;display:flex;align-items:center;z-index:2}
.mm .mm-mq .mq-dot{position:absolute;left:114px;top:50%;transform:translateY(-50%);width:14px;height:14px;border-radius:2px;background:var(--blue);z-index:3;box-shadow:0 0 8px rgba(59,130,246,.3)}
.mm .mm-mq .mq-label{font-size:11px;font-family:var(--fm);color:var(--blue);font-weight:600;display:flex;align-items:center;gap:8px}
.mm .mm-mq .mq-label::before{content:'IBM MQ';font-size:8px;font-weight:700;letter-spacing:1px;padding:2px 6px;border-radius:3px;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.2)}
.mm .mm-mq .mq-conn{position:absolute;left:132px;top:50%;width:38px;height:2px;background:var(--blue);z-index:2}

/* Compliance fan-out */
.mm .mm-comp{padding-left:170px;padding-right:24px;margin:8px 0;position:relative;z-index:2}
.mm .mm-comp-label{font-size:10px;font-family:var(--fm);color:var(--amber);letter-spacing:1px;text-transform:uppercase;font-weight:600;margin-bottom:8px}
.mm .mm-comp-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:12px;background:rgba(245,158,11,.03);border:1px solid rgba(245,158,11,.12);border-radius:var(--r)}
.mm .mm-comp-item{display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--bg3);border-radius:6px;border:1px solid var(--bdr);font-size:12px}
.mm .mm-comp-item .ci-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.mm .mm-comp-item .ci-name{font-weight:600;color:var(--t1)}
.mm .mm-comp-item .ci-sla{font-family:var(--fm);color:var(--t3);font-size:10px;margin-left:auto}

/* MQ Return callout (left side) */
.mm .mm-mqr{position:absolute;left:-164px;top:8px;width:150px;z-index:4;padding:10px 12px;border-radius:8px;background:rgba(59,130,246,.05);border:1px solid rgba(59,130,246,.2);text-align:right}
.mm .mm-mqr::after{content:'';position:absolute;right:-14px;top:18px;width:14px;height:2px;background:rgba(59,130,246,.35)}
.mm .mm-mqr .mr-arrow{font-size:16px;color:var(--blue);line-height:1;margin-bottom:4px}
.mm .mm-mqr .mr-badge{display:inline-block;font-size:8px;font-family:var(--fm);font-weight:700;letter-spacing:1px;padding:2px 6px;border-radius:3px;margin-bottom:6px;background:rgba(59,130,246,.12);color:var(--blue);border:1px solid rgba(59,130,246,.2)}
.mm .mm-mqr .mr-queue{font-size:10px;font-family:var(--fm);font-weight:600;color:var(--blue);margin-bottom:3px}
.mm .mm-mqr .mr-desc{font-size:10px;color:var(--t3);line-height:1.4}

/* Dev callout (right side) */
.mm .mm-dev{position:absolute;right:-260px;top:4px;width:230px;z-index:4;padding:12px 14px;border-radius:8px;background:rgba(249,115,22,.06);border:1px dashed rgba(249,115,22,.3);transition:all .3s}
.mm .mm-dev:hover{border-color:rgba(249,115,22,.5);box-shadow:0 0 20px rgba(249,115,22,.08)}
.mm .mm-dev .dc-badge{display:inline-block;font-size:8px;font-family:var(--fm);font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:2px 8px;border-radius:3px;margin-bottom:8px;background:rgba(249,115,22,.12);color:var(--orange);border:1px solid rgba(249,115,22,.2)}
.mm .mm-dev .dc-title{font-size:12px;font-weight:700;color:var(--orange);margin-bottom:4px}
.mm .mm-dev .dc-desc{font-size:11px;color:var(--t2);line-height:1.5}
.mm .mm-dev .dc-desc strong{color:var(--orange)}
.mm .mm-dev::before{content:'';position:absolute;left:-16px;top:16px;width:16px;height:1px;background:rgba(249,115,22,.3)}

/* Metro legend */
.mm-legend{max-width:900px;margin:24px auto 0;padding:0}
.mm-legend-inner{background:var(--bg2);border:1px solid var(--bdr);border-radius:var(--r);padding:16px 20px}
.mm-legend h4{font-size:11px;font-family:var(--fm);font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--t3);margin-bottom:12px}
.mm-legend-grid{display:flex;flex-wrap:wrap;gap:14px 24px}
.mm-legend-item{display:flex;align-items:center;gap:8px;font-size:11px;color:var(--t2)}

/* Spacer */
.mm .mm-spc{height:8px}

/* Metro responsive */
@media(max-width:768px){
  .mm .mm-trunk{left:40px}
  .mm .mm-st{padding-left:90px}
  .mm .mm-dot{left:30px}
  .mm .mm-st::before{left:52px;width:38px}
  .mm .mm-kafka{padding-left:90px}.mm .mm-kafka .mk-dot{left:34px}.mm .mm-kafka .mk-conn{left:52px;width:38px}
  .mm .mm-mq{padding-left:90px}.mm .mm-mq .mq-dot{left:34px}.mm .mm-mq .mq-conn{left:52px;width:38px}
  .mm .mm-comp{padding-left:90px}
  .mm .mm-mqr,.mm .mm-dev{display:none}
  .mm .mm-comp-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="bgx"></div>
<div class="c">
<header class="hdr">
<div class="hdr-b">System Architecture v2.0</div>
<h1>PayoneX</h1>
<p class="hdr-sub">Enterprise Payment Processing Platform</p>
<p class="hdr-s">Kafka-driven, event-sourced microservices architecture for core banking payments across Singapore, Hong Kong, UK, and India ‚Äî with self-healing infrastructure, per-country clearing house configurations, and autonomous recovery.</p>
<div class="hdr-m">
<span class="m1">Apache Kafka Backbone</span>
<span class="m2">ISO 20022 Native</span>
<span class="m3">Self-Healing Infrastructure</span>
<span class="m4">Multi-Region (SG ¬∑ HK ¬∑ UK ¬∑ IN)</span>
</div>
</header>
</div>

<nav>
<div class="ni">
<button class="nb a" onclick="scrollTo_('flow')">Payment Flow</button>
<button class="nb" onclick="scrollTo_('inflow')">Inbound Flow</button>
<button class="nb" onclick="scrollTo_('outflow')">Outbound Flow</button>
<button class="nb" onclick="scrollTo_('clearing')">Clearing Houses</button>
<button class="nb" onclick="scrollTo_('config')">Country Config</button>
<button class="nb" onclick="scrollTo_('compliance')">Compliance</button>
<button class="nb" onclick="scrollTo_('saga')">Accounting Saga</button>
<button class="nb" onclick="scrollTo_('state')">State Machine</button>
<button class="nb" onclick="scrollTo_('kafka')">Kafka Topics</button>
<button class="nb" onclick="scrollTo_('databases')">Database Isolation</button>
<button class="nb" onclick="scrollTo_('selfheal')">Self-Healing</button>
<button class="nb" onclick="scrollTo_('resilience')">Resilience</button>
<button class="nb" onclick="scrollTo_('sla')">SLA Targets</button>
<button class="nb" onclick="scrollTo_('stack')">Tech Stack</button>
</div>
</nav>

<div class="c">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="flow">
<div class="sl">Section 01</div>
<h2 class="st">End-to-End Payment Flow</h2>
<p class="sd">A payment instruction traverses six architectural tiers. Each transition is mediated by Kafka topics. Compliance screening runs in parallel where SLAs permit, following AWS/industry best practices for real-time payment orchestration.</p>

<div class="flow-box" data-label="PAYMENT LIFECYCLE ‚Äî END TO END" style="padding-top:40px">
<div style="text-align:center">
<div style="margin-bottom:8px">
<div class="fn n-ex"><div class="ni2">UPSTREAM</div><div class="nl">IBM MQ</div><div class="ns">MT/MX Messages</div></div>
<div class="fn n-ex"><div class="ni2">UPSTREAM</div><div class="nl">SFTP Files</div><div class="ns">CSV ¬∑ XML ¬∑ FIN</div></div>
<div class="fn n-ex"><div class="ni2">UPSTREAM</div><div class="nl">REST/gRPC</div><div class="ns">JSON ¬∑ Protobuf</div></div>
<div class="fn n-ex"><div class="ni2">UPSTREAM</div><div class="nl">ISO 20022</div><div class="ns">pain.001 ¬∑ pacs.008</div></div>
</div>
<div style="color:var(--t3);font-size:18px;margin:4px 0">‚ñæ</div>
<div class="fn n-bl" style="min-width:520px"><div class="ni2">TIER 1 ‚Äî INGESTION GATEWAY</div><div class="nl">Protocol Translation ¬∑ Deduplication ¬∑ Envelope Wrapping</div><div class="ns">Redis dedup (TTL 7d) ¬∑ UUID v7 ¬∑ Camel / Spring Integration</div></div>

<div class="kb">‚ñ∏ KAFKA <span class="kt">payments.inbound.raw</span> ‚óÇ</div>

<div class="fn n-cy" style="min-width:520px"><div class="ni2">TIER 2 ‚Äî MESSAGE PROCESSING</div><div class="nl">Schema Validation ¬∑ MT‚ÜíMX Conversion ¬∑ Enrichment</div><div class="ns">JAXB/XSD ¬∑ BIC/IBAN resolve ¬∑ FX rates ¬∑ Fee calc</div></div>

<div class="kb"><span class="kt">payments.parsed.canonical</span> ‚îÄ‚îÄ‚ñ∏ <span class="kt">payments.enriched</span></div>

<div style="margin:8px 0">
<div class="fn n-am"><div class="ni2">SANCTIONS</div><div class="nl">OFAC¬∑EU¬∑UN¬∑MAS</div><div class="ns">Fircosoft &lt;200ms</div></div>
<div class="fn n-am"><div class="ni2">AML</div><div class="nl">Tx Monitor</div><div class="ns">Actimize &lt;2s</div></div>
<div class="fn n-am"><div class="ni2">FRAUD</div><div class="nl">ML Scoring</div><div class="ns">gRPC &lt;100ms</div></div>
<div class="fn n-am"><div class="ni2">PEP</div><div class="nl">PEP Screen</div><div class="ns">Hybrid &lt;500ms</div></div>
</div>

<div class="kb"><span class="kt">payments.compliance.response</span> ‚îÄ‚îÄ‚ñ∏ <span class="kt">payments.clearing.outbound</span></div>

<div style="margin:8px 0">
<div class="fn n-gn"><div class="ni2">SG</div><div class="nl">MEPS+</div><div class="ns">RTGS &lt;30s</div></div>
<div class="fn n-gn"><div class="ni2">SG</div><div class="nl">FAST</div><div class="ns">Real-time &lt;10s</div></div>
<div class="fn n-gn"><div class="ni2">HK</div><div class="nl">CHATS</div><div class="ns">RTGS &lt;60s</div></div>
<div class="fn n-gn"><div class="ni2">UK</div><div class="nl">FPS</div><div class="ns">Real-time &lt;15s</div></div>
<div class="fn n-gn"><div class="ni2">IN</div><div class="nl">RTGS/NEFT</div><div class="ns">24x7 &lt;30m</div></div>
<div class="fn n-gn"><div class="ni2">GLOBAL</div><div class="nl">SWIFT gpi</div><div class="ns">X-border &lt;4h</div></div>
</div>

<div class="kb"><span class="kt">payments.clearing.response</span> ‚îÄ‚îÄ‚ñ∏ <span class="kt">payments.accounting.booked</span></div>

<div class="fn n-vi" style="min-width:520px"><div class="ni2">TIER 5 ‚Äî ACCOUNTING & SETTLEMENT</div><div class="nl">Double-Entry Ledger ¬∑ Saga Orchestration ¬∑ GL Posting</div><div class="ns">Append-only event-sourced ¬∑ Compensating transactions ¬∑ Nostro/Vostro</div></div>

<div class="kb"><span class="kt">payments.notifications</span> <span class="kt">payments.recon.eod</span> <span class="kt">payments.status.changes</span></div>

<div class="fn n-ro" style="min-width:520px"><div class="ni2">TIER 6 ‚Äî REPORTING & RECONCILIATION</div><div class="nl">Real-Time Dashboards ¬∑ Regulatory Reports ¬∑ EOD Recon</div><div class="ns">Kafka Streams views ¬∑ ClickHouse analytics ¬∑ GraphQL API</div></div>
</div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INBOUND FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="inflow">
<div class="sl">Section 01a</div>
<h2 class="st">Inbound Payment Flow</h2>
<p class="sd">Complete end-to-end flow for an incoming payment. Example: DBS debits Alice SGD 500 via FAST ‚Üí PayoneX receives pacs.008 ‚Üí credits Bob's account. Two-stage pacs.002 model: immediate ACTC technical ACK, then final ACSC settlement status after full processing.</p>

<!-- ‚ïê‚ïê‚ïê L‚ÜíR SIMPLE VIEW (always visible) ‚ïê‚ïê‚ïê -->
<div class="flow-box" data-label="INBOUND ‚Äî LEFT TO RIGHT (FAST ¬∑ DBS ‚Üí PAYONEX)" style="padding:36px 24px 16px;overflow-x:auto;margin-bottom:24px">
<div style="display:flex;align-items:center;gap:4px;min-width:max-content">
<div class="fn n-ex" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">ORIGINATOR</div><div class="nl" style="font-size:11px">DBS</div><div class="ns">pacs.008 out</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-gn" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">CLEARING</div><div class="nl" style="font-size:11px">FAST</div><div class="ns">ABS/NETS</div></div>
<span class="arr">‚Üí</span>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:4px;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.25);display:flex;align-items:center;justify-content:center"><span class="blu" style="font-size:10px;font-weight:700">MQ</span></div><div class="mono blu" style="font-size:7px;margin-top:2px">inbound</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-bl" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 1</div><div class="nl" style="font-size:11px">Ingest</div><div class="ns">Dedup ¬∑ Validate</div></div>
<span class="arr">‚Üí</span>
<div style="padding:8px 14px;border-radius:8px;background:rgba(16,185,129,.15);border:2px solid rgba(16,185,129,.4);text-align:center"><div class="mono grn" style="font-size:11px;font-weight:700">‚ö° ACTC</div><div class="mono dim" style="font-size:9px">&lt;500ms ACK</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">inbound.raw</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-cy" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 2</div><div class="nl" style="font-size:11px">Process</div><div class="ns">Lookup ¬∑ Enrich</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">enriched</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-am" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 3</div><div class="nl" style="font-size:11px">Compliance</div><div class="ns">4√ó parallel</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">compliance</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-vi" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 5</div><div class="nl" style="font-size:11px">Account</div><div class="ns">Credit ¬∑ GL Post</div></div>
<span class="arr">‚Üí</span>
<div style="padding:8px 14px;border-radius:8px;background:rgba(6,182,212,.15);border:2px solid rgba(6,182,212,.4);text-align:center"><div class="mono cyn" style="font-size:11px;font-weight:700">‚úì ACSC</div><div class="mono dim" style="font-size:9px">&lt;5s final</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">status.changes</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-ro" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 6</div><div class="nl" style="font-size:11px">Report</div><div class="ns">Recon ¬∑ Notify</div></div>
</div>
</div>
<div class="mono dim" style="font-size:10px;margin-top:-16px;margin-bottom:0;padding-left:4px">No Tier 4 Clearing for inbound ‚Äî clearing house (FAST) is the entry point, not a destination. MQ return paths (ACTC + ACSC pacs.002) go back to FAST via IBM MQ Outbound.</div>

<!-- ‚ïê‚ïê‚ïê COLLAPSIBLE METRO MAP ‚ïê‚ïê‚ïê -->
<button class="collapse-trigger" onclick="toggleCollapse(this)">
  <span class="chevron">&#9654;</span>
  <span class="ct-badge">METRO MAP</span>
  Detailed Inbound Flow ‚Äî Transit Diagram
</button>
<div class="collapse-body">
<div class="flow-box" data-label="INBOUND ‚Äî METRO MAP (FAST ¬∑ DBS ‚Üí PAYONEX)" style="padding:40px 24px 16px;overflow:visible;margin-top:12px">
<div class="mm">
  <div class="mm-trunk"></div>

  <!-- Station 0: DBS -->
  <div class="mm-st ext" style="position:relative">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Originating Bank</div>
      <h3>DBS initiates Credit Transfer</h3>
      <div class="mm-desc">Alice sends SGD 500 to Bob &middot; DBS constructs pacs.008</div>
      <div class="mm-tech">ISO 20022 &middot; pacs.008.001.08</div>
    </div>
    <div class="mm-dev">
      <div class="dc-badge">DEV Simulation</div>
      <div class="dc-title">Phantom CLI / Test Harness</div>
      <div class="dc-desc">Generates sample <strong>pacs.008</strong> messages with configurable scenarios (amount, currency, sender BIC)</div>
    </div>
  </div>

  <div class="mm-spc"></div>

  <!-- Station 1: FAST Clearing -->
  <div class="mm-st s-green" style="position:relative">
    <div class="mm-dot" style="width:28px;height:28px;left:107px;top:10px;box-shadow:0 0 16px rgba(16,185,129,.35);border-width:4px"></div>
    <div class="mm-card" style="border-color:rgba(16,185,129,.3);background:linear-gradient(135deg,var(--bg2),rgba(16,185,129,.05))">
      <div class="mm-tier">Clearing House &mdash; FAST Network</div>
      <h3>FAST delivers pacs.008 to PayoneX</h3>
      <div class="mm-desc">ABS / NETS real-time clearing &middot; Routed to PayoneX MQ Inbound Queue</div>
      <div class="mm-tech">IBM MQ &middot; Real-time settlement &middot; This is where the payment enters our system</div>
    </div>
    <div class="mm-dev">
      <div class="dc-badge">DEV Simulation</div>
      <div class="dc-title">Phantom Simulator</div>
      <div class="dc-desc">Docker container mimics <strong>FAST clearing</strong> &mdash; injects pacs.008 onto <strong>MQ Inbound</strong> queue, waits for pacs.002 response</div>
    </div>
  </div>

  <!-- MQ Inbound -->
  <div class="mm-mq">
    <div class="mq-dot"></div>
    <div class="mq-conn"></div>
    <div class="mq-label">MQ.INBOUND.FAST.001</div>
  </div>

  <!-- Station 2: Tier 1 -->
  <div class="mm-st s-blue">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 1 &mdash; Ingestion Gateway</div>
      <h3>Receive &amp; Validate</h3>
      <div class="mm-desc">MQ Consume &middot; Dedup (Redis) &middot; XSD Validate &middot; Envelope Wrap</div>
      <div class="mm-tech">Assign UUID v7 &middot; Parse pacs.008 header</div>
    </div>
  </div>

  <div class="mm-spc"></div>

  <!-- ACTC ACK -->
  <div class="mm-st sp-green" style="position:relative">
    <div class="mm-dot"><span class="dot-icon">‚ö°</span></div>
    <div class="mm-card">
      <div class="mm-tier">&#9889; ACTC Acknowledgement</div>
      <h3>Immediate pacs.002 ACTC &middot; &lt;500ms</h3>
      <div class="mm-desc">AcceptedTechnicalValidation &mdash; sent back to FAST via MQ Outbound</div>
      <div class="mm-tech">pacs.002.001.10 &middot; ACTC status code &middot; SLA &lt; 500ms</div>
    </div>
    <div class="mm-mqr">
      <div class="mr-arrow">&#8593; Back to Clearing House</div>
      <div class="mr-badge">IBM MQ</div>
      <div class="mr-queue">MQ.OUTBOUND.FAST.001</div>
      <div class="mr-desc">pacs.002 ACTC response sent back to FAST</div>
    </div>
  </div>

  <!-- Kafka: payments.inbound.raw -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.inbound.raw</div>
  </div>

  <!-- Station 3: Tier 2 -->
  <div class="mm-st s-cyan">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 2 &mdash; Message Processing</div>
      <h3>Enrich &amp; Resolve</h3>
      <div class="mm-desc">Beneficiary Lookup &middot; Business Validation &middot; Enrichment</div>
      <div class="mm-tech">BIC/IBAN resolve &middot; FX rates &middot; Fee calc</div>
    </div>
  </div>

  <!-- Kafka: payments.enriched -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.enriched</div>
  </div>

  <!-- Station 4: Tier 3 Compliance -->
  <div class="mm-st s-amber">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 3 &mdash; Compliance Engine</div>
      <h3>Parallel Screening</h3>
      <div class="mm-desc">Internal async saga &middot; 4 engines run simultaneously &middot; ALL must PASS</div>
      <div class="mm-tech">Saga orchestrator &middot; Circuit breaker per check &middot; Timeout fallback</div>
    </div>
  </div>

  <!-- Compliance fan-out -->
  <div class="mm-comp">
    <div class="mm-comp-label">Parallel Fan-Out &rarr; Fan-In</div>
    <div class="mm-comp-grid">
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--rose)"></div><span class="ci-name">Sanctions</span><span class="ci-sla">OFAC/EU/UN/MAS &lt;200ms</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--amber)"></div><span class="ci-name">AML</span><span class="ci-sla">Tx Monitor &lt;2s</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--violet)"></div><span class="ci-name">Fraud</span><span class="ci-sla">ML Scoring &lt;100ms</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--cyan)"></div><span class="ci-name">PEP Screen</span><span class="ci-sla">&lt;500ms</span></div>
    </div>
  </div>

  <!-- Kafka: payments.compliance.passed -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.compliance.passed</div>
  </div>

  <div class="mm-spc"></div>

  <!-- Station 5: Tier 5 Accounting -->
  <div class="mm-st s-violet">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 5 &mdash; Accounting &amp; Settlement</div>
      <h3>Double-Entry Ledger</h3>
      <div class="mm-desc">Double-Entry Ledger &middot; Saga Orchestration &middot; GL Posting</div>
      <div class="mm-tech">Nostro/Vostro &middot; Compensating transactions &middot; Idempotent writes</div>
    </div>
  </div>

  <div class="mm-spc"></div>

  <!-- ACSC Final -->
  <div class="mm-st sp-cyan" style="position:relative">
    <div class="mm-dot"><span class="dot-icon">‚úì</span></div>
    <div class="mm-card">
      <div class="mm-tier">&#10003; ACSC Final Confirmation</div>
      <h3>Final pacs.002 ACSC &middot; &lt;5s E2E</h3>
      <div class="mm-desc">AcceptedSettlementCompleted &mdash; sent back to FAST via MQ Outbound</div>
      <div class="mm-tech">pacs.002.001.10 &middot; ACSC status code &middot; End-to-end SLA &lt; 5 seconds</div>
    </div>
    <div class="mm-mqr">
      <div class="mr-arrow">&#8593; Back to Clearing House</div>
      <div class="mr-badge">IBM MQ</div>
      <div class="mr-queue">MQ.OUTBOUND.FAST.001</div>
      <div class="mr-desc">pacs.002 ACSC final &mdash; settled &amp; irrevocable</div>
    </div>
  </div>

  <!-- Kafka: payments.status.changes -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.status.changes</div>
  </div>

  <!-- Station 6: Tier 6 Reporting -->
  <div class="mm-st s-rose">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 6 &mdash; Reporting &amp; Analytics</div>
      <h3>Real-Time Dashboards</h3>
      <div class="mm-desc">Real-Time Dashboards &middot; Regulatory Reports &middot; EOD Recon</div>
      <div class="mm-tech">ClickHouse analytics &middot; GraphQL API &middot; MAS/HKMA compliance</div>
    </div>
  </div>
</div><!-- /mm -->

<!-- Metro Legend -->
<div class="mm-legend">
  <div class="mm-legend-inner">
    <h4>Legend</h4>
    <div class="mm-legend-grid">
      <div class="mm-legend-item"><div style="width:20px;height:4px;border-radius:2px;background:var(--blue)"></div><span>Trunk Line</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px dashed var(--t3);background:var(--bg)"></div><span>External</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px solid var(--blue);background:var(--bg)"></div><span>Tier Station</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px solid var(--green);box-shadow:0 0 8px rgba(16,185,129,.5)"></div><span>pacs.002</span></div>
      <div class="mm-legend-item"><div style="width:8px;height:8px;border-radius:2px;rotate:45deg;background:var(--kafka)"></div><span>Kafka</span></div>
      <div class="mm-legend-item"><div style="width:8px;height:8px;border-radius:2px;background:var(--blue);box-shadow:0 0 4px rgba(59,130,246,.3)"></div><span>IBM MQ</span></div>
      <div class="mm-legend-item"><div style="width:14px;height:8px;border-radius:3px;border:1px dashed rgba(249,115,22,.5);background:rgba(249,115,22,.08)"></div><span style="color:var(--orange)">Phantom (DEV)</span></div>
    </div>
  </div>
</div>
</div>
</div>

<!-- SLA callout (always visible) -->
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-top:20px">
<div class="card" style="border-left:3px solid var(--green);text-align:center"><div class="sla-v grn" style="font-size:20px">&lt;500ms</div><p style="font-size:12px;font-weight:600">1st pacs.002 (ACTC)</p><p class="mono dim" style="font-size:10px">Technical ACK</p></div>
<div class="card" style="border-left:3px solid var(--cyan);text-align:center"><div class="sla-v cyn" style="font-size:20px">&lt;5s</div><p style="font-size:12px;font-weight:600">2nd pacs.002 (ACSC)</p><p class="mono dim" style="font-size:10px">Settlement complete</p></div>
<div class="card" style="border-left:3px solid var(--blue);text-align:center"><div class="sla-v blu" style="font-size:20px">&lt;5s</div><p style="font-size:12px;font-weight:600">FAST E2E (p99)</p><p class="mono dim" style="font-size:10px">Full inbound lifecycle</p></div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OUTBOUND FLOW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="outflow">
<div class="sl">Section 01b</div>
<h2 class="st">Outbound Payment Flow</h2>
<p class="sd">Complete end-to-end flow for an outgoing payment. Example: John initiates SGD 500 transfer to Alice at DBS via FAST. Two-stage Saga: pre-clearing (debit + suspense) and post-clearing (settle Nostro + GL). In dev, <strong style="color:var(--amber)">Phantom</strong> simulator replaces the real clearing network.</p>

<!-- Horizontal L‚ÜíR Overview -->
<div class="flow-box" data-label="OUTBOUND ‚Äî LEFT TO RIGHT" style="padding:36px 24px 16px;overflow-x:auto;margin-bottom:24px">
<div style="display:flex;align-items:center;gap:4px;min-width:max-content">
<div class="fn n-ex" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">INTERNAL</div><div class="nl" style="font-size:11px">Channel</div><div class="ns">REST ¬∑ gRPC</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-bl" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 1</div><div class="nl" style="font-size:11px">Ingest</div><div class="ns">Dedup ¬∑ Wrap</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">inbound.raw</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-cy" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 2</div><div class="nl" style="font-size:11px">Build</div><div class="ns">pacs.008 ¬∑ Route</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">enriched</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-am" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 3</div><div class="nl" style="font-size:11px">Compliance</div><div class="ns">Screen all</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">compliance</div></div>
<span class="arr">‚Üí</span>
<div style="padding:8px 14px;border-radius:8px;background:rgba(139,92,246,.12);border:2px solid rgba(139,92,246,.3);text-align:center"><div class="mono vio" style="font-size:10px;font-weight:700">SAGA ‚ë†‚ë°‚ë¢</div><div class="mono dim" style="font-size:8px">Pre-clear</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">clearing.out</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-gn" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 4</div><div class="nl" style="font-size:11px">Clear</div><div class="ns">Submit pacs.008</div></div>
<span class="arr">‚Üí</span>
<div style="padding:8px 14px;border-radius:8px;background:rgba(245,158,11,.08);border:1px dashed rgba(245,158,11,.4);text-align:center"><div class="mono amb" style="font-size:10px;font-weight:700">FAST / üëª</div><div class="mono dim" style="font-size:8px">Clearing ¬∑ Phantom</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-bl" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 1</div><div class="nl" style="font-size:11px">Receive</div><div class="ns">pacs.002 in</div></div>
<div style="display:flex;flex-direction:column;align-items:center;padding:0 4px"><div style="width:24px;height:24px;border-radius:6px;background:rgba(232,82,63,.12);border:1px solid rgba(232,82,63,.25);display:flex;align-items:center;justify-content:center"><span class="kaf" style="font-size:12px">‚¨°</span></div><div class="mono kaf" style="font-size:7px;margin-top:2px">clearing.resp</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-cy" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 2</div><div class="nl" style="font-size:11px">Correlate</div><div class="ns">OrgnlTxId</div></div>
<span class="arr">‚Üí</span>
<div style="padding:8px 14px;border-radius:8px;background:rgba(139,92,246,.12);border:2px solid rgba(139,92,246,.3);text-align:center"><div class="mono vio" style="font-size:10px;font-weight:700">SAGA ‚ë£‚ë§</div><div class="mono dim" style="font-size:8px">Post-clear</div></div>
<span class="arr">‚Üí</span>
<div class="fn n-ro" style="min-width:auto;padding:8px 12px"><div class="ni2" style="font-size:8px">TIER 6</div><div class="nl" style="font-size:11px">Report</div><div class="ns">Complete</div></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê COLLAPSIBLE OUTBOUND METRO MAP ‚ïê‚ïê‚ïê -->
<button class="collapse-trigger" onclick="toggleCollapse(this)">
  <span class="chevron">&#9654;</span>
  <span class="ct-badge">METRO MAP</span>
  Detailed Outbound Flow ‚Äî Transit Diagram
</button>
<div class="collapse-body">
<div class="flow-box" data-label="OUTBOUND ‚Äî METRO MAP (PAYONEX ‚Üí DBS VIA FAST)" style="padding:40px 24px 16px;overflow:visible;margin-top:12px">
<div class="mm">
  <div class="mm-trunk"></div>

  <!-- Station 0: Internal Channel -->
  <div class="mm-st ext">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Internal &mdash; Payment Instruction</div>
      <h3>John initiates SGD 500 to Alice (DBS)</h3>
      <div class="mm-desc">Via REST API / gRPC / pain.001 from internal channel</div>
      <div class="mm-tech">ISO 20022 pain.001 &middot; Internal canonical format</div>
    </div>
  </div>

  <div class="mm-spc"></div>

  <!-- Station 1: Tier 1 Ingestion -->
  <div class="mm-st s-blue">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 1 &mdash; Ingestion Gateway</div>
      <h3>Dedup &amp; Envelope Wrap</h3>
      <div class="mm-desc">Redis dedup &middot; Assign UUID v7 &middot; Protocol normalization</div>
      <div class="mm-tech">Internal canonical format &middot; Parse instruction header</div>
    </div>
  </div>

  <!-- Kafka: payments.inbound.raw -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.inbound.raw</div>
  </div>

  <!-- Station 2: Tier 2 Build -->
  <div class="mm-st s-cyan">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 2 &mdash; Message Processing</div>
      <h3>Build pacs.008 &amp; Route</h3>
      <div class="mm-desc">BIC/IBAN resolve &middot; FX rate lookup &middot; Fee calculation &middot; Routing decision</div>
      <div class="mm-tech">Construct ISO 20022 pacs.008 &middot; Route: FAST (real-time, SGD)</div>
    </div>
  </div>

  <!-- Kafka: payments.enriched -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.enriched</div>
  </div>

  <!-- Station 3: Tier 3 Compliance -->
  <div class="mm-st s-amber">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 3 &mdash; Compliance Engine</div>
      <h3>Parallel Screening</h3>
      <div class="mm-desc">Internal async saga &middot; 4 engines run simultaneously &middot; ALL must PASS</div>
      <div class="mm-tech">Saga orchestrator &middot; Circuit breaker per check &middot; Timeout fallback</div>
    </div>
  </div>

  <!-- Compliance fan-out -->
  <div class="mm-comp">
    <div class="mm-comp-label">Parallel Fan-Out &rarr; Fan-In</div>
    <div class="mm-comp-grid">
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--rose)"></div><span class="ci-name">Sanctions</span><span class="ci-sla">OFAC/EU/UN/MAS &lt;200ms</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--amber)"></div><span class="ci-name">AML</span><span class="ci-sla">Tx Monitor &lt;2s</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--violet)"></div><span class="ci-name">Fraud</span><span class="ci-sla">ML Scoring &lt;100ms</span></div>
      <div class="mm-comp-item"><div class="ci-dot" style="background:var(--cyan)"></div><span class="ci-name">PEP Screen</span><span class="ci-sla">&lt;500ms</span></div>
    </div>
  </div>

  <!-- Kafka: payments.compliance.response -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.compliance.response</div>
  </div>

  <!-- Station 4: Tier 5 Pre-Clearing Saga -->
  <div class="mm-st s-violet">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 5 &mdash; Pre-Clearing Saga (Part 1 of 2)</div>
      <h3>&#9312; Debit &middot; &#9313; Fees &middot; &#9314; FX Convert</h3>
      <div class="mm-desc">Debit John's account &rarr; Suspense &middot; Calculate fees &rarr; Fee Income GL &middot; FX if cross-currency</div>
      <div class="mm-tech">Funds held in suspense until clearing confirms &middot; Compensating transactions on RJCT</div>
    </div>
  </div>

  <!-- Kafka: payments.clearing.outbound -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.clearing.outbound</div>
  </div>

  <!-- Station 5: Tier 4 Clearing Adapter -->
  <div class="mm-st s-green" style="position:relative">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 4 &mdash; Clearing Adapter (FAST)</div>
      <h3>Submit pacs.008 to Clearing</h3>
      <div class="mm-desc">FastClearingAdapter.submit() &middot; Strategy Pattern &middot; Async non-blocking</div>
      <div class="mm-tech">pacs.008 placed on MQ Outbound Queue &middot; Awaits pacs.002 response</div>
    </div>
  </div>

  <!-- MQ Outbound -->
  <div class="mm-mq">
    <div class="mq-dot"></div>
    <div class="mq-conn"></div>
    <div class="mq-label">MQ.OUTBOUND.FAST.001</div>
  </div>

  <!-- Station 6: FAST / Phantom -->
  <div class="mm-st s-green" style="position:relative">
    <div class="mm-dot" style="width:28px;height:28px;left:107px;top:10px;box-shadow:0 0 16px rgba(16,185,129,.35);border-width:4px"></div>
    <div class="mm-card" style="border-color:rgba(16,185,129,.3);background:linear-gradient(135deg,var(--bg2),rgba(16,185,129,.05))">
      <div class="mm-tier">Clearing House &mdash; FAST Network</div>
      <h3>FAST processes pacs.008 &middot; Returns pacs.002</h3>
      <div class="mm-desc">ABS / NETS validates &amp; settles &middot; Returns pacs.002 (ACSC or RJCT)</div>
      <div class="mm-tech">Response placed on MQ Inbound Queue &middot; Full round-trip</div>
    </div>
    <div class="mm-dev">
      <div class="dc-badge">DEV Simulation</div>
      <div class="dc-title">Phantom Simulator</div>
      <div class="dc-desc">Docker container mimics <strong>FAST clearing</strong> &mdash; configurable: Success (ACSC), Rejection (RJCT), Timeout, Partial</div>
    </div>
  </div>

  <!-- MQ Inbound (response) -->
  <div class="mm-mq">
    <div class="mq-dot"></div>
    <div class="mq-conn"></div>
    <div class="mq-label">MQ.INBOUND.FAST.001</div>
  </div>

  <!-- Station 7: Tier 1 Response -->
  <div class="mm-st s-blue">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 1 &mdash; Ingestion Gateway (Response)</div>
      <h3>Receive pacs.002 &amp; Parse</h3>
      <div class="mm-desc">MQ Consume &middot; Dedup &middot; Detect clearing response by message type</div>
      <div class="mm-tech">Same bidirectional gateway &middot; Parse ACTC/ACSC/RJCT status</div>
    </div>
  </div>

  <!-- Kafka: payments.clearing.response -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.clearing.response</div>
  </div>

  <!-- Station 8: Tier 2 Correlate -->
  <div class="mm-st s-cyan">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 2 &mdash; Correlation Engine</div>
      <h3>Match via OrgnlTxId</h3>
      <div class="mm-desc">pacs.002 contains OrgnlMsgId + OrgnlTxId &rarr; lookup original payment</div>
      <div class="mm-tech">Route matched payment to Accounting &middot; State transition update</div>
    </div>
  </div>

  <!-- Kafka: payments.accounting.booked -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.accounting.booked</div>
  </div>

  <!-- Station 9: Tier 5 Post-Clearing Saga -->
  <div class="mm-st sp-cyan" style="position:relative">
    <div class="mm-dot"><span class="dot-icon">‚úì</span></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 5 &mdash; Post-Clearing Saga (Part 2 of 2)</div>
      <h3>&#9315; Settle Nostro &middot; &#9316; GL Posting</h3>
      <div class="mm-desc">Suspense &rarr; Nostro/Vostro &middot; Post to Core Banking GL &middot; Payment complete</div>
      <div class="mm-tech">If RJCT &rarr; compensate: reverse debit, refund fees, release suspense</div>
    </div>
  </div>

  <!-- Kafka: payments.status.changes -->
  <div class="mm-kafka">
    <div class="mk-dot"></div>
    <div class="mk-conn"></div>
    <div class="mk-label">payments.status.changes</div>
  </div>

  <!-- Station 10: Tier 6 Reporting -->
  <div class="mm-st s-rose">
    <div class="mm-dot"></div>
    <div class="mm-card">
      <div class="mm-tier">Tier 6 &mdash; Reporting &amp; Analytics</div>
      <h3>Real-Time Dashboards</h3>
      <div class="mm-desc">Dashboard Update &middot; Customer Notification &middot; EOD Recon Entry</div>
      <div class="mm-tech">ClickHouse analytics &middot; Status: COMPLETED &middot; Audit trail sealed</div>
    </div>
  </div>
</div><!-- /mm -->

<!-- Metro Legend -->
<div class="mm-legend">
  <div class="mm-legend-inner">
    <h4>Legend</h4>
    <div class="mm-legend-grid">
      <div class="mm-legend-item"><div style="width:20px;height:4px;border-radius:2px;background:var(--blue)"></div><span>Trunk Line</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px dashed var(--t3);background:var(--bg)"></div><span>External / Internal</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px solid var(--blue);background:var(--bg)"></div><span>Tier Station</span></div>
      <div class="mm-legend-item"><div style="width:10px;height:10px;border-radius:50%;border:2px solid var(--cyan);box-shadow:0 0 8px rgba(6,182,212,.5)"></div><span>Settlement ‚úì</span></div>
      <div class="mm-legend-item"><div style="width:8px;height:8px;border-radius:2px;rotate:45deg;background:var(--kafka)"></div><span>Kafka</span></div>
      <div class="mm-legend-item"><div style="width:8px;height:8px;border-radius:2px;background:var(--blue);box-shadow:0 0 4px rgba(59,130,246,.3)"></div><span>IBM MQ</span></div>
      <div class="mm-legend-item"><div style="width:14px;height:8px;border-radius:3px;border:1px dashed rgba(249,115,22,.5);background:rgba(249,115,22,.08)"></div><span style="color:var(--orange)">Phantom (DEV)</span></div>
    </div>
  </div>
</div>
</div>
</div>

<!-- Phantom callout -->
<div class="callout ca" style="margin-top:20px">
<h4>Phantom ‚Äî Mock Clearing Simulator</h4>
<p><strong>Phantom</strong> is a standalone Docker container that simulates clearing house behavior in the dev environment. It listens on the MQ Outbound Queue, receives pacs.008 messages submitted by the Clearing Adapter, and responds with pacs.002 messages on the MQ Inbound Queue ‚Äî testing the full round-trip path through Tier 1 and Tier 2 on the response side.<br><br>
<strong>Why not self-simulate in the adapter?</strong> If the adapter fakes the response directly into Kafka, it bypasses the entire inbound path (MQ ‚Üí Tier 1 ‚Üí Tier 2 correlation). Phantom ensures the response traverses the exact same path as production, validating the bidirectional gateway design.<br><br>
<strong>Configurable scenarios:</strong> Success (ACSC), Rejection (RJCT), Timeout (no response), Partial (ACTC only, delayed ACSC), Network error. Configurable response delay per rail type (FAST ~200ms, RTGS ~5s, SWIFT ~15s).</p>
</div>

<!-- SLA summary cards -->
<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px;margin-top:16px">
<div class="card" style="border-left:3px solid var(--violet);text-align:center"><div class="sla-v vio" style="font-size:18px">Part 1</div><p style="font-size:11px;font-weight:600">Pre-Clearing Saga</p><p class="mono dim" style="font-size:10px">Debit ¬∑ Fees ¬∑ FX</p></div>
<div class="card" style="border-left:3px solid var(--green);text-align:center"><div class="sla-v grn" style="font-size:18px">Submit</div><p style="font-size:11px;font-weight:600">Clearing Adapter</p><p class="mono dim" style="font-size:10px">pacs.008 ‚Üí MQ Out</p></div>
<div class="card" style="border-left:3px solid var(--amber);text-align:center"><div class="sla-v amb" style="font-size:18px">Wait</div><p style="font-size:11px;font-weight:600">Clearing Response</p><p class="mono dim" style="font-size:10px">Async ¬∑ Non-blocking</p></div>
<div class="card" style="border-left:3px solid var(--violet);text-align:center"><div class="sla-v vio" style="font-size:18px">Part 2</div><p style="font-size:11px;font-weight:600">Post-Clearing Saga</p><p class="mono dim" style="font-size:10px">Nostro ¬∑ GL Post</p></div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CLEARING HOUSES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="clearing">
<div class="sl">Section 02</div>
<h2 class="st">Clearing House Deep Dive</h2>
<p class="sd">Each clearing house has unique protocols, operating hours, cutoff times, message formats, and settlement mechanics. The adapter pattern isolates these differences so the core processing pipeline remains unchanged across regions.</p>

<table>
<tr><th>Region</th><th>System</th><th>Operator</th><th>Protocol</th><th>Hours (Local)</th><th>Cutoff</th><th>Settlement</th><th>Min Amt</th><th>ISO 20022</th></tr>
<tr><td><span class="badge bb">SG</span></td><td class="mono kaf" style="font-weight:600">MEPS+</td><td>MAS</td><td>ISO 20022 / SWIFT Alliance Lite2</td><td>24x7 (interbank subset)</td><td>18:00 SGT (customer)</td><td>Real-time gross (individual)</td><td>No minimum</td><td>Live since Aug 2022 (L4L++)</td></tr>
<tr><td><span class="badge bb">SG</span></td><td class="mono kaf" style="font-weight:600">FAST</td><td>ABS / NETS</td><td>ISO 20022</td><td>24x7x365</td><td>None (real-time)</td><td>Immediate credit</td><td>No minimum</td><td>Native</td></tr>
<tr><td><span class="badge ba">HK</span></td><td class="mono kaf" style="font-weight:600">HKD CHATS</td><td>HKICL / HKMA</td><td>SWIFTNet FIN Y-Copy</td><td>08:30‚Äì18:30 HKT</td><td>18:00 HKT (customer)</td><td>Real-time gross (individual)</td><td>No minimum</td><td>Migrated Apr 2024</td></tr>
<tr><td><span class="badge ba">HK</span></td><td class="mono kaf" style="font-weight:600">USD/EUR/RMB CHATS</td><td>HKICL</td><td>SWIFTNet FIN Y-Copy</td><td>08:30‚Äì18:30 (RMB to 05:00)</td><td>17:00/18:00 HKT</td><td>Real-time gross</td><td>No minimum</td><td>Migrated Apr 2024</td></tr>
<tr><td><span class="badge bg">UK</span></td><td class="mono kaf" style="font-weight:600">CHAPS</td><td>BoE</td><td>ISO 20022 / SWIFT</td><td>06:00‚Äì18:00 GMT</td><td>17:00 GMT (customer)</td><td>Real-time gross</td><td>No minimum (typ. >¬£10K)</td><td>Live since Jun 2023</td></tr>
<tr><td><span class="badge bg">UK</span></td><td class="mono kaf" style="font-weight:600">Faster Payments</td><td>Pay.UK / VocaLink</td><td>ISO 8583 ‚Üí ISO 20022 migration</td><td>24x7x365</td><td>None (real-time)</td><td>Near-instant (seconds)</td><td>No min; max ¬£1M</td><td>Migration underway</td></tr>
<tr><td><span class="badge bv">IN</span></td><td class="mono kaf" style="font-weight:600">RTGS</td><td>RBI</td><td>ISO 20022 (customized)</td><td>24x7x365 (since Dec 2020)</td><td>None (24x7)</td><td>Real-time gross (individual)</td><td>‚Çπ2 lakh minimum</td><td>Customized ISO 20022</td></tr>
<tr><td><span class="badge bv">IN</span></td><td class="mono kaf" style="font-weight:600">NEFT</td><td>RBI</td><td>Proprietary + ISO elements</td><td>24x7x365 (48 batches/day)</td><td>Half-hourly batch cycles</td><td>Deferred Net Settlement (DNS)</td><td>No minimum</td><td>Partial</td></tr>
<tr><td><span class="badge bv">IN</span></td><td class="mono kaf" style="font-weight:600">UPI / IMPS</td><td>NPCI</td><td>Proprietary API</td><td>24x7x365</td><td>None</td><td>Immediate (via IMPS)</td><td>No minimum; max ‚Çπ5L (UPI)</td><td>No (proprietary)</td></tr>
<tr><td><span class="badge br">GLOBAL</span></td><td class="mono kaf" style="font-weight:600">SWIFT gpi</td><td>SWIFT</td><td>ISO 20022 MX (since Nov 2025)</td><td>Varies by corridor</td><td>Correspondent dependent</td><td>Via nostro/vostro chain</td><td>No minimum</td><td>Mandatory since Nov 2025</td></tr>
</table>

<div class="callout ca">
<h4>Key Clearing House Differences That Affect Product Configuration</h4>
<p><strong>Settlement Model:</strong> MEPS+, CHATS, RTGS (India) use real-time gross settlement. NEFT uses deferred net settlement in 48 half-hourly batches. This fundamentally changes how your accounting engine books entries ‚Äî RTGS payments can be booked immediately on confirmation, while NEFT requires batch settlement cycle awareness.<br><br>
<strong>Operating Windows:</strong> Singapore FAST, UK FPS, and India RTGS/NEFT now operate 24x7x365. However, HK CHATS is still 08:30‚Äì18:30 HKT on weekdays only. Your adapter must implement time-window validation and queue payments received outside operating hours for next-window submission.<br><br>
<strong>Minimum Amounts:</strong> India's RTGS mandates ‚Çπ2 lakh minimum ‚Äî below this, route to NEFT/IMPS. Your routing engine must enforce these thresholds per clearing house.<br><br>
<strong>ISO 20022 Maturity:</strong> MEPS+ and CHATS have completed migration. SWIFT mandated ISO 20022 exclusively since Nov 2025. India's RTGS runs a customized variant. UK Faster Payments is still migrating. Your message transformer must handle variant-specific schemas per clearing house.</p>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COUNTRY CONFIG MATRIX ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="config">
<div class="sl">Section 03</div>
<h2 class="st">Country-Level Configuration Matrix</h2>
<p class="sd">The platform uses a configuration-driven adapter pattern. Each country deployment loads region-specific configurations from a central Config Service (backed by Consul/etcd). The core processing pipeline remains identical ‚Äî only the adapter layer and configuration parameters change.</p>

<table>
<tr><th>Parameter</th><th>Singapore</th><th>Hong Kong</th><th>United Kingdom</th><th>India</th></tr>
<tr><td style="font-weight:600">Primary RTGS</td><td>MEPS+ (MAS)</td><td>HKD CHATS (HKICL)</td><td>CHAPS (BoE)</td><td>RTGS (RBI)</td></tr>
<tr><td style="font-weight:600">Retail Real-time</td><td>FAST (ABS)</td><td>FPS (HKICL)</td><td>Faster Payments (VocaLink)</td><td>UPI/IMPS (NPCI)</td></tr>
<tr><td style="font-weight:600">Batch/Deferred</td><td>IBG (SGDCC)</td><td>Bulk BACS equivalent</td><td>BACS</td><td>NEFT (48 batches/day)</td></tr>
<tr><td style="font-weight:600">Message Format</td><td>ISO 20022 (HVPS+/CBPR+)</td><td>SWIFTNet FIN Y-Copy + ISO</td><td>ISO 20022 (CHAPS MX)</td><td>ISO 20022 (RBI customized)</td></tr>
<tr><td style="font-weight:600">Connectivity</td><td>SWIFT Alliance Lite2</td><td>SWIFTNet + eMBT</td><td>SWIFT / VocaLink API</td><td>SFMS (INFINET)</td></tr>
<tr><td style="font-weight:600">Sanctions Lists</td><td>MAS + OFAC + EU + UN</td><td>HKMA + OFAC + EU + UN</td><td>HMT (OFSI) + OFAC + EU + UN</td><td>RBI + MEA + OFAC + UN</td></tr>
<tr><td style="font-weight:600">Regulator</td><td>MAS</td><td>HKMA</td><td>FCA / PRA / BoE</td><td>RBI</td></tr>
<tr><td style="font-weight:600">Reporting</td><td>MAS STR + FATF</td><td>JFIU STR</td><td>NCA SAR + FCA reporting</td><td>FIU-IND STR + RBI returns</td></tr>
<tr><td style="font-weight:600">Currency</td><td>SGD (primary) + USD</td><td>HKD + USD + EUR + RMB</td><td>GBP + EUR</td><td>INR</td></tr>
<tr><td style="font-weight:600">Value Date Rules</td><td>T+0 (FAST), T+0 (MEPS+)</td><td>T+0 (CHATS)</td><td>T+0 (FPS/CHAPS)</td><td>T+0 (RTGS), T+0 to T+1 (NEFT)</td></tr>
<tr><td style="font-weight:600">Operating Hours</td><td>24x7 (FAST) / business hrs (MEPS+ subset)</td><td>08:30‚Äì18:30 HKT (Mon‚ÄìFri)</td><td>24x7 (FPS) / 06:00‚Äì18:00 (CHAPS)</td><td>24x7x365 (RTGS/NEFT since 2020)</td></tr>
<tr><td style="font-weight:600">Routing Threshold</td><td>Any amount ‚Üí FAST; High value ‚Üí MEPS+</td><td>All values ‚Üí CHATS</td><td>‚â§¬£1M ‚Üí FPS; &gt;¬£1M ‚Üí CHAPS</td><td>&lt;‚Çπ2L ‚Üí NEFT/IMPS; ‚â•‚Çπ2L ‚Üí RTGS</td></tr>
</table>

<div class="callout cv">
<h4>Configuration-Driven Adapter Pattern</h4>
<p>Each clearing house adapter is a pluggable microservice conforming to a standard <code>ClearingAdapter</code> interface: <code>formatMessage()</code>, <code>submit()</code>, <code>parseResponse()</code>, <code>handleTimeout()</code>. Country-specific parameters (cutoff times, routing thresholds, message schemas, connectivity endpoints, sanctions lists) are externalized into a Config Service (Consul/etcd) with hot-reload capability. When you deploy to a new country, you: (1) implement the adapter interface for the local clearing house, (2) configure the country parameters in Config Service, (3) register the new adapter in the routing decision matrix ‚Äî zero changes to the core pipeline.</p>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê COMPLIANCE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="compliance">
<div class="sl">Section 04</div>
<h2 class="st">Compliance Screening Architecture</h2>
<p class="sd">Fan-out/fan-in with parallel engines. Country-specific sanctions lists loaded per region. Investigation workflow with configurable SLA timers.</p>

<div class="g4">
<div class="card" style="border-left:3px solid var(--amber)"><h4 class="amb">Sanctions Screener</h4><p class="mono dim">OFAC ¬∑ EU ¬∑ UN + Country-specific (MAS/HKMA/OFSI/RBI)</p><p>REST API to Fircosoft/Accuity. <strong>&lt;200ms sync</strong>. On Hit ‚Üí REFER to Investigation.</p></div>
<div class="card" style="border-left:3px solid var(--amber)"><h4 class="amb">AML Engine</h4><p class="mono dim">Transaction Monitoring Rules ¬∑ Threshold alerts</p><p>Kafka event to Actimize/NICE. <strong>&lt;2 seconds</strong>. On Hit ‚Üí ALERT compliance team.</p></div>
<div class="card" style="border-left:3px solid var(--amber)"><h4 class="amb">Fraud Detection</h4><p class="mono dim">Behavioral Scoring ¬∑ Velocity Checks ¬∑ ML Models</p><p>gRPC to scoring engine. <strong>&lt;100ms</strong>. On Hit ‚Üí BLOCK or ESCALATE.</p></div>
<div class="card" style="border-left:3px solid var(--amber)"><h4 class="amb">PEP Screening</h4><p class="mono dim">Politically Exposed Persons ¬∑ Country-specific lists</p><p>Batch + real-time hybrid. <strong>&lt;500ms</strong>. On Hit ‚Üí REFER with risk score.</p></div>
</div>
<div class="callout ca"><h4>Aggregation: ALL must PASS</h4><p>Correlation-based fan-in. Timeout: 30s (real-time), 5min (batch). Auto-escalation on timeout. Investigation SLA: 4h domestic, 24h cross-border. Full audit trail via event stream.</p></div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SAGA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="saga">
<div class="sl">Section 05</div>
<h2 class="st">Accounting Saga Pattern</h2>
<p class="sd">Distributed transactions via Saga with compensating transactions. Each step idempotent. On failure, compensations execute in reverse order.</p>
<div class="flow-box" data-label="SAGA ORCHESTRATION" style="padding-top:40px;display:flex;gap:8px;overflow-x:auto;align-items:stretch">
<div class="card" style="flex:1;min-width:150px;text-align:center"><div class="sla-v vio" style="opacity:.4;font-size:20px">01</div><h4 style="font-size:12px">Debit Customer</h4><p style="font-size:11px">Customer Acct ‚Üí Suspense</p><div class="badge br" style="margin-top:8px;font-size:10px">‚Ü© Credit back</div></div>
<div style="display:flex;align-items:center;color:var(--t3)">‚Üí</div>
<div class="card" style="flex:1;min-width:150px;text-align:center"><div class="sla-v vio" style="opacity:.4;font-size:20px">02</div><h4 style="font-size:12px">Calculate Fees</h4><p style="font-size:11px">Apply rules ‚Üí Fee Income GL</p><div class="badge br" style="margin-top:8px;font-size:10px">‚Ü© Reverse fees</div></div>
<div style="display:flex;align-items:center;color:var(--t3)">‚Üí</div>
<div class="card" style="flex:1;min-width:150px;text-align:center"><div class="sla-v vio" style="opacity:.4;font-size:20px">03</div><h4 style="font-size:12px">FX Conversion</h4><p style="font-size:11px">CCY1 ‚Üí CCY2 Position</p><div class="badge br" style="margin-top:8px;font-size:10px">‚Ü© Reverse FX</div></div>
<div style="display:flex;align-items:center;color:var(--t3)">‚Üí</div>
<div class="card" style="flex:1;min-width:150px;text-align:center"><div class="sla-v vio" style="opacity:.4;font-size:20px">04</div><h4 style="font-size:12px">Clear Settlement</h4><p style="font-size:11px">Suspense ‚Üí Nostro/Vostro</p><div class="badge br" style="margin-top:8px;font-size:10px">‚Ü© Reverse settle</div></div>
<div style="display:flex;align-items:center;color:var(--t3)">‚Üí</div>
<div class="card" style="flex:1;min-width:150px;text-align:center"><div class="sla-v vio" style="opacity:.4;font-size:20px">05</div><h4 style="font-size:12px">GL Posting</h4><p style="font-size:11px">Post to Core Banking GL</p><div class="badge br" style="margin-top:8px;font-size:10px">‚Ü© Reverse GL</div></div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE MACHINE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="state">
<div class="sl">Section 06</div>
<h2 class="st">Payment State Machine</h2>
<div class="flow-box" data-label="STATE TRANSITIONS" style="padding-top:36px">
<div style="display:flex;flex-wrap:wrap;align-items:center;gap:6px">
<div class="fn n-bl"><div class="nl">RECEIVED</div></div><span class="arr">‚Üí</span>
<div class="fn n-cy"><div class="nl">VALIDATED</div></div><span class="arr">‚Üí</span>
<div class="fn n-cy"><div class="nl">ENRICHED</div></div><span class="arr">‚Üí</span>
<div class="fn n-am"><div class="nl">SCREENING</div></div><span class="arr">‚Üí</span>
<div style="display:inline-block"><div class="fn n-am"><div class="nl">SCREENED_PASS</div></div><br><div class="fn n-am" style="border-style:dashed;font-size:11px"><div class="nl">UNDER_INVESTIGATION</div></div></div><span class="arr">‚Üí</span>
<div class="fn n-gn"><div class="nl">SUBMITTED</div></div><span class="arr">‚Üí</span>
<div class="fn n-gn"><div class="nl">CONFIRMED</div></div><span class="arr">‚Üí</span>
<div class="fn n-vi"><div class="nl">BOOKED</div></div><span class="arr">‚Üí</span>
<div class="fn" style="background:rgba(16,185,129,.2);border:1px solid rgba(16,185,129,.4);color:#34d399"><div class="nl">COMPLETED</div></div>
</div>
<div style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding-left:16px">
<span class="mono dim" style="font-size:11px">Failure states:</span>
<div class="fn n-ro" style="padding:6px 12px"><div class="nl" style="font-size:11px">REJECTED</div></div>
<div class="fn n-ro" style="padding:6px 12px;border-style:dashed"><div class="nl" style="font-size:11px">CLEARING_TIMEOUT</div></div>
<div class="fn n-ro" style="padding:6px 12px;border-style:dashed"><div class="nl" style="font-size:11px">RETURNED</div></div>
</div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KAFKA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="kafka">
<div class="sl">Section 07</div>
<h2 class="st">Kafka Topic Architecture</h2>
<p class="sd">Exactly-once via Transactional Outbox (Debezium CDC) + idempotent producers + read_committed consumers.</p>
<table>
<tr><th>Topic</th><th>Partitions</th><th>RF</th><th>Retention</th><th>Key</th><th>Policy</th></tr>
<tr><td class="mono kaf">payments.inbound.raw</td><td><span class="badge bb">24</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">30d</span></td><td>source_id+msg_ref</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.parsed.canonical</td><td><span class="badge bb">24</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">30d</span></td><td>payment_id</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.enriched</td><td><span class="badge bb">24</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">30d</span></td><td>payment_id</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.compliance.*</td><td><span class="badge bb">12</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">14d</span></td><td>payment_id</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.clearing.*</td><td><span class="badge bb">12</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">30d</span></td><td>payment_id</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.accounting.booked</td><td><span class="badge bb">24</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">90d</span></td><td>payment_id</td><td>Delete</td></tr>
<tr><td class="mono kaf">payments.status.changes</td><td><span class="badge bb">24</span></td><td><span class="badge bg">3</span></td><td><span class="badge bv">Compact</span></td><td>payment_id</td><td>Compact</td></tr>
<tr><td class="mono kaf">payments.dlq.*</td><td><span class="badge bb">6</span></td><td><span class="badge bg">3</span></td><td><span class="badge ba">90d</span></td><td>original_key</td><td>Delete</td></tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATABASES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="databases">
<div class="sl">Section 08</div>
<h2 class="st">Database-per-Service Segregation</h2>
<p class="sd">Each service owns its data exclusively. HashiCorp Vault dynamic secrets. K8s network policies enforce isolation.</p>
<div class="g3">
<div class="card" style="border-left:3px solid var(--blue)"><h4>ingestion_db</h4><p class="mono dim">PostgreSQL 16 ¬∑ ~50 GB/mo</p><p>Dedup tracking, raw message metadata, ingestion audit.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>payment_master_db</h4><p class="mono dim">PostgreSQL 16 + Citus ¬∑ ~200 GB/mo</p><p>Core records, events, validations, status history. Sharded.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>reference_data_db</h4><p class="mono dim">PostgreSQL 16 + Redis ¬∑ ~10 GB</p><p>BIC directory, IBAN rules, FX rates (15s refresh), fee configs.</p></div>
<div class="card" style="border-left:3px solid var(--amber)"><h4>compliance_db</h4><p class="mono dim">PostgreSQL 16 ¬∑ ~100 GB/mo</p><p>Investigation cases, screening results, analyst actions, audit.</p></div>
<div class="card" style="border-left:3px solid var(--green)"><h4>routing_db</h4><p class="mono dim">PostgreSQL 16 ¬∑ ~80 GB/mo</p><p>Clearing submissions, SLA timers, circuit breaker state, retries.</p></div>
<div class="card" style="border-left:3px solid var(--violet)"><h4>ledger_db</h4><p class="mono dim">PostgreSQL 16 + Citus ¬∑ ~500 GB/mo</p><p>Append-only double-entry ledger, saga state, GL postings.</p></div>
<div class="card" style="border-left:3px solid var(--rose)"><h4>analytics_db</h4><p class="mono dim">ClickHouse ¬∑ ~1 TB/mo</p><p>Columnar analytics, materialized views, regulatory reports.</p></div>
<div class="card" style="border-left:3px solid var(--orange)"><h4>event_store</h4><p class="mono dim">Kafka commit log</p><p>Source of truth. 30-90d hot, 7yr S3 archive for compliance.</p></div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SELF-HEALING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="selfheal">
<div class="sl">Section 09</div>
<h2 class="st">Self-Monitoring ¬∑ Self-Healing ¬∑ Self-Recovery</h2>
<p class="sd">The platform is designed as a self-managing organism. Inspired by modern AI-enhanced Kubernetes practices, the system continuously observes its own health, autonomously remediates failures, and recovers to full operational capacity without human intervention for 95% of incident types.</p>

<h3 style="font-size:18px;font-weight:700;color:var(--green);margin:24px 0 16px">üîç Self-Monitoring</h3>
<div class="g3">
<div class="card" style="border-left:3px solid var(--green)"><h4>Health Probes (Every Service)</h4><p><strong>Liveness Probe:</strong> Heartbeat check ‚Äî if it fails, K8s kills and restarts the container immediately. <strong>Readiness Probe:</strong> Gatekeeper ‚Äî no traffic routed until service is fully initialized. <strong>Startup Probe:</strong> Grace period for slow-starting services (DB migration, cache warmup).</p></div>
<div class="card" style="border-left:3px solid var(--green)"><h4>Business Health Metrics</h4><p>Beyond infrastructure health: payment throughput rate, clearing success ratio, DLQ depth, consumer lag, sanctions screening latency, accounting balance drift detection. These are custom Prometheus metrics exposed by every service.</p></div>
<div class="card" style="border-left:3px solid var(--green)"><h4>Anomaly Detection</h4><p>ML-based anomaly detection on payment volume patterns, latency distributions, and error rates. Detects subtle degradations (memory leaks, connection pool exhaustion) 24-48 hours before they cause outages. Isolation Forest + LSTM models trained on operational data.</p></div>
<div class="card" style="border-left:3px solid var(--green)"><h4>Dependency Health Map</h4><p>Real-time service dependency graph (built via Istio service mesh telemetry). Visualizes health propagation ‚Äî if Redis is degrading, see which downstream services are impacted before cascading failures occur.</p></div>
</div>

<h3 style="font-size:18px;font-weight:700;color:var(--cyan);margin:24px 0 16px">üîß Self-Healing</h3>
<div class="g3">
<div class="card" style="border-left:3px solid var(--cyan)"><h4>Kubernetes Auto-Restart</h4><p>Failed containers auto-restarted via restartPolicy: Always. Pod Disruption Budgets ensure minimum replicas during voluntary disruptions. HPA scales up when consumer lag exceeds threshold. VPA right-sizes resource requests based on actual usage.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>Circuit Breaker Auto-Recovery</h4><p>When clearing house adapter enters OPEN state (5 failures / 50% fail rate), it automatically transitions to HALF-OPEN after 30s cooldown and sends probe requests. On success ‚Üí CLOSED. Payments buffered in Kafka retry topic during outage ‚Äî zero data loss.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>DLQ Auto-Replay</h4><p>Categorized DLQ with auto-classification: <strong>transient</strong> errors (timeout, conn refused) ‚Üí auto-replay after 5min. <strong>Recoverable</strong> errors (dependency down) ‚Üí auto-replay when dependency health restored. <strong>Poison</strong> messages ‚Üí alert + manual review only.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>Database Connection Healing</h4><p>HikariCP connection pool with leak detection (30s threshold). Auto-eviction of stale connections. PgBouncer as connection pooler with auto-reconnect. If primary DB fails, automatic promotion of streaming replica within 15 seconds.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>Kafka Consumer Auto-Rebalance</h4><p>When a consumer instance dies, Kafka automatically rebalances partitions to surviving consumers (cooperative sticky rebalancing for minimal disruption). Consumer lag monitoring auto-scales consumer count to prevent backlog accumulation.</p></div>
<div class="card" style="border-left:3px solid var(--cyan)"><h4>Config Hot-Reload</h4><p>Country-specific configurations (cutoff times, routing thresholds, sanctions lists) hot-reloaded from Consul/etcd without service restart. Feature flags via LaunchDarkly for instant enable/disable of clearing adapters during incidents.</p></div>
</div>

<h3 style="font-size:18px;font-weight:700;color:var(--violet);margin:24px 0 16px">üîÑ Self-Recovery</h3>
<div class="g3">
<div class="card" style="border-left:3px solid var(--violet)"><h4>Event Replay for State Recovery</h4><p>If a service loses its database, the complete state can be reconstructed by replaying Kafka events from the 30-day retained log. Event sourcing means the Kafka log IS the source of truth ‚Äî databases are just materialized views.</p></div>
<div class="card" style="border-left:3px solid var(--violet)"><h4>Multi-AZ Failover</h4><p>All services run across 3 availability zones. Kafka brokers spread with rack-awareness. PostgreSQL streaming replication with auto-failover (Patroni). If an entire AZ goes down, remaining AZs absorb the load within 60 seconds.</p></div>
<div class="card" style="border-left:3px solid var(--violet)"><h4>Cross-Region DR</h4><p>Kafka MirrorMaker 2 replicates to DR region continuously (RPO=0). Automated failover runbook in PagerDuty: detect region failure ‚Üí DNS failover ‚Üí consumer group rebalance in DR ‚Üí full service restored in &lt;5 minutes.</p></div>
<div class="card" style="border-left:3px solid var(--violet)"><h4>Reconciliation Auto-Repair</h4><p>EOD recon engine automatically detects mismatches between clearing confirmations and ledger entries. For known patterns (duplicate posting, missed confirmation), it auto-generates compensating entries and alerts ops team for verification.</p></div>
</div>

<div class="callout cg">
<h4>Self-Healing Maturity Model</h4>
<p><strong>Level 1 (Day 1):</strong> K8s auto-restart + circuit breakers + DLQ retry = handles 70% of incidents autonomously.<br>
<strong>Level 2 (Month 3):</strong> + anomaly detection + auto-scaling + dependency health maps = handles 85% autonomously.<br>
<strong>Level 3 (Month 6):</strong> + ML-based predictive healing + auto-recon repair + event replay recovery = handles 95% autonomously.<br>
<strong>Target:</strong> Mean Time to Detect (MTTD) &lt; 30 seconds. Mean Time to Recover (MTTR) &lt; 2 minutes for automated incidents.</p>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESILIENCE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="resilience">
<div class="sl">Section 10</div>
<h2 class="st">Resilience & Recovery Patterns</h2>
<div class="g3">
<div class="card"><h4>3-Tier DLQ <span class="badge br">RETRY</span></h4><p>Tier 1: Immediate (100ms‚Äì1s, 3x). Tier 2: Delayed topic (30s‚Äì1h, 4x). Tier 3: Terminal DLQ (manual). PagerDuty alert on depth >10/5min.</p></div>
<div class="card"><h4>Idempotency <span class="badge bb">FRAMEWORK</span></h4><p>Redis-backed store with PG fallback. Deterministic key. Result stored atomically with business state. TTL 7 days.</p></div>
<div class="card"><h4>Exactly-Once <span class="badge bv">OUTBOX</span></h4><p>Transactional Outbox: business state + event in single DB tx. Debezium CDC reads via WAL. Idempotent producers. read_committed consumers.</p></div>
<div class="card"><h4>Event Replay <span class="badge bk">KAFKA</span></h4><p>30d operational, 90d accounting, 7yr S3 archive. Full state reconstruction from event log for DR and audit.</p></div>
</div>
<table style="margin-top:16px">
<tr><th>Component</th><th>RPO</th><th>RTO</th><th>Strategy</th></tr>
<tr><td>Kafka Cluster</td><td class="grn" style="font-weight:600">0 (zero loss)</td><td>&lt;5 min</td><td>Multi-AZ RF=3, MirrorMaker 2 to DR</td></tr>
<tr><td>PostgreSQL</td><td>&lt;1 min</td><td>&lt;15 min</td><td>Streaming replication + WAL archive (S3)</td></tr>
<tr><td>Redis Cache</td><td>Best effort</td><td>&lt;2 min</td><td>Sentinel auto-failover; rebuild from DB</td></tr>
<tr><td>Clearing Adapters</td><td>N/A</td><td>&lt;30 sec</td><td>Active-passive health-check failover</td></tr>
<tr><td>Application Services</td><td>N/A</td><td>&lt;60 sec</td><td>K8s auto-restart, rolling deployments</td></tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SLA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="sla">
<div class="sl">Section 11</div>
<h2 class="st">Performance & SLA Targets</h2>

<!-- Production SLA Targets -->
<h3 style="font-size:16px;font-weight:700;color:var(--cyan);margin:20px 0 12px">Production Targets</h3>
<div class="g5">
<div class="card" style="border-left:3px solid var(--green);text-align:center"><div class="sla-v grn" style="font-size:22px">&lt;500ms</div><p style="font-weight:700">pacs.002 ACK (ACTC)</p><p style="font-size:11px">Inbound ‚Äî all rails</p><p class="mono dim" style="font-size:10px">Immediate technical ACK</p></div>
<div class="card" style="border-left:3px solid var(--cyan);text-align:center"><div class="sla-v cyn" style="font-size:22px">&lt;5s</div><p style="font-weight:700">pacs.002 Final (ACSC)</p><p style="font-size:11px">Inbound ‚Äî real-time rails</p><p class="mono dim" style="font-size:10px">FAST ¬∑ FPS ¬∑ UPI ¬∑ Faster Payments</p></div>
<div class="card" style="border-left:3px solid var(--blue);text-align:center"><div class="sla-v blu" style="font-size:22px">&lt;15s</div><p style="font-weight:700">pacs.002 Final (ACSC)</p><p style="font-size:11px">Inbound ‚Äî RTGS rails</p><p class="mono dim" style="font-size:10px">MEPS+ ¬∑ CHATS ¬∑ CHAPS ¬∑ RTGS</p></div>
<div class="card" style="border-left:3px solid var(--amber);text-align:center"><div class="sla-v amb" style="font-size:22px">&lt;35s</div><p style="font-weight:700">pacs.002 Final (ACSC)</p><p style="font-size:11px">Inbound ‚Äî cross-border</p><p class="mono dim" style="font-size:10px">SWIFT gpi ¬∑ multi-hop</p></div>
<div class="card" style="text-align:center"><div class="sla-v cyn">&lt;5s</div><p>FAST E2E (p99)</p><p class="mono dim" style="font-size:10px">Alert &gt;8s</p></div>
<div class="card" style="text-align:center"><div class="sla-v blu">&lt;15s</div><p>RTGS E2E (p99)</p><p class="mono dim" style="font-size:10px">Alert &gt;25s</p></div>
<div class="card" style="text-align:center"><div class="sla-v grn">10K</div><p>Ingestion (msg/s)</p><p class="mono dim" style="font-size:10px">Alert &lt;5K</p></div>
<div class="card" style="text-align:center"><div class="sla-v amb">&lt;10ms</div><p>Kafka Latency (p99)</p><p class="mono dim" style="font-size:10px">Alert &gt;50ms</p></div>
<div class="card" style="text-align:center"><div class="sla-v vio">&lt;5ms</div><p>DB OLTP (p95)</p><p class="mono dim" style="font-size:10px">Alert &gt;20ms</p></div>
<div class="card" style="text-align:center"><div class="sla-v ros">99.99%</div><p>Availability</p><p class="mono dim" style="font-size:10px">52 min/yr</p></div>
<div class="card" style="text-align:center"><div class="sla-v org">&lt;60s</div><p>Service Recovery</p><p class="mono dim" style="font-size:10px">K8s restart</p></div>
<div class="card" style="text-align:center"><div class="sla-v kaf">&lt;30s</div><p>MTTD</p><p class="mono dim" style="font-size:10px">Self-monitoring</p></div>
<div class="card" style="text-align:center"><div class="sla-v grn">&lt;2m</div><p>MTTR (Auto)</p><p class="mono dim" style="font-size:10px">Self-healing</p></div>
</div>

<!-- Dev Environment Testing Targets -->
<h3 style="font-size:16px;font-weight:700;color:var(--amber);margin:28px 0 12px">Dev Environment Testing (1K TPS Target)</h3>
<p class="sd" style="margin-bottom:16px">Development and SLA validation runs on a single workstation (64 GB RAM, 16-core, NVMe). Target: <strong>1K TPS</strong> with mock transactions to validate architecture correctness and measure SLA adherence before scaling to production targets.</p>
<div class="g5">
<div class="card" style="border-left:3px solid var(--amber);text-align:center"><div class="sla-v amb" style="font-size:32px">1K TPS</div><p style="font-weight:700">Load Test Target</p><p class="mono dim" style="font-size:10px">Mock txns ¬∑ Measure all SLAs</p></div>
<div class="card" style="border-left:3px solid var(--green);text-align:center"><div class="sla-v grn" style="font-size:32px">&lt;500ms</div><p style="font-weight:700">pacs.002 ACK (ACTC)</p><p class="mono dim" style="font-size:10px">Inbound technical ACK SLA</p></div>
<div class="card" style="text-align:center"><div class="sla-v cyn">&lt;5s</div><p>FAST E2E (p99)</p><p class="mono dim" style="font-size:10px">Same as prod</p></div>
<div class="card" style="text-align:center"><div class="sla-v blu">&lt;15s</div><p>RTGS E2E (p99)</p><p class="mono dim" style="font-size:10px">Same as prod</p></div>
<div class="card" style="text-align:center"><div class="sla-v grn">&lt;50ms</div><p>Kafka Latency (p99)</p><p class="mono dim" style="font-size:10px">Relaxed (single broker)</p></div>
<div class="card" style="text-align:center"><div class="sla-v vio">&lt;20ms</div><p>DB OLTP (p95)</p><p class="mono dim" style="font-size:10px">Relaxed (single node)</p></div>
</div>


</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TECH STACK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="stack">
<div class="sl">Section 12</div>
<h2 class="st">Technology Stack</h2>
<div class="g4">
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Event Streaming</p><h4>Apache Kafka 3.7+</h4><p class="mono sec">Backbone, exactly-once, replay</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Upstream Bridge</p><h4>IBM MQ + Camel</h4><p class="mono sec">Legacy protocol bridge</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Services</p><h4>Spring Boot + Java 21</h4><p class="mono sec">Virtual threads, mature ecosystem</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Primary DB</p><h4>PostgreSQL 16 + Citus</h4><p class="mono sec">ACID, horizontal sharding</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Cache</p><h4>Redis Cluster 7.2+</h4><p class="mono sec">Dedup, ref data, idempotency</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Analytics</p><h4>ClickHouse</h4><p class="mono sec">Columnar, 100x faster aggregation</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">CDC / Outbox</p><h4>Debezium 2.5+</h4><p class="mono sec">WAL-based outbox pattern</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Orchestration</p><h4>Kubernetes (EKS/GKE)</h4><p class="mono sec">Multi-region, auto-scaling</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Service Mesh</p><h4>Istio 1.21+</h4><p class="mono sec">mTLS, traffic mgmt, telemetry</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Secrets</p><h4>HashiCorp Vault</h4><p class="mono sec">Dynamic secrets, auto-rotation</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Config Service</p><h4>Consul / etcd</h4><p class="mono sec">Hot-reload, country configs</p></div>
<div class="card"><p class="mono dim" style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px">Observability</p><h4>Prometheus + OTel + Grafana</h4><p class="mono sec">Metrics, tracing, dashboards</p></div>
</div>
</section>

<footer class="footer">
PayoneX ¬∑ Enterprise Payment Processing Platform ¬∑ Architecture v2.0 ¬∑ February 2026 ¬∑ Confidential
</footer>

</div>

<script>
function scrollTo_(id){document.getElementById(id)?.scrollIntoView({behavior:'smooth',block:'start'})}
function toggleCollapse(btn){
  btn.classList.toggle('open');
  const body=btn.nextElementSibling;
  body.classList.toggle('open');
}
document.querySelectorAll('.nb').forEach(b=>b.addEventListener('click',function(){document.querySelectorAll('.nb').forEach(x=>x.classList.remove('a'));this.classList.add('a')}));
// Intersection observer for nav highlighting
const sections=document.querySelectorAll('section[id]');
const obs=new IntersectionObserver(entries=>{entries.forEach(e=>{if(e.isIntersecting){document.querySelectorAll('.nb').forEach(b=>b.classList.remove('a'));const btn=document.querySelector(`.nb[onclick*="${e.target.id}"]`);if(btn)btn.classList.add('a')}})},{threshold:0.15,rootMargin:'-80px 0px -60% 0px'});
sections.forEach(s=>obs.observe(s));
</script>
</body>
</html>
