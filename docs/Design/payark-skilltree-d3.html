<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayArk — Training Academy Skill Tree</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
:root {
  --bg: #08090d; --bg2: #0f1118; --bg3: #151822; --bg4: #1a1e2e;
  --bdr: #1f2438; --bdr2: #2a3050;
  --t1: #e8eaf0; --t2: #8b90a0; --t3: #555a6e;
  --blue: #3b82f6; --cyan: #06b6d4; --green: #10b981; --amber: #f59e0b;
  --rose: #f43f5e; --violet: #8b5cf6; --orange: #f97316;
  --r: 10px;
  --fd: 'Outfit', sans-serif; --fm: 'JetBrains Mono', monospace;
  --tr: 0.3s cubic-bezier(0.4,0,0.2,1);
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:var(--fd);background:var(--bg);color:var(--t1);line-height:1.65;overflow-x:hidden}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--bdr2);border-radius:3px}

/* Background texture */
.bgx{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(59,130,246,.08),transparent),radial-gradient(circle at 20% 80%,rgba(139,92,246,.05),transparent),linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:100%,100%,60px 60px,60px 60px}

.container{max-width:1400px;margin:0 auto;padding:0 32px;position:relative;z-index:1}

/* Header — Variant G */
.hdr{padding:48px 0 32px;text-align:center;border-bottom:1px solid var(--bdr)}
.hdr h1{font-size:clamp(48px,6vw,72px);font-weight:900;letter-spacing:-2px;line-height:1.1;background:linear-gradient(135deg,#fff 0%,var(--blue) 50%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 25px rgba(59,130,246,.25));position:relative;display:inline-block}
.hdr h1::before{content:'';position:absolute;bottom:-6px;left:0;width:100%;height:2px;background:var(--bdr);border-radius:2px}
.hdr h1::after{content:'';position:absolute;bottom:-10px;right:-2px;width:10px;height:10px;border-radius:50%;background:var(--cyan);box-shadow:0 0 10px var(--cyan),0 0 20px rgba(6,182,212,.4);animation:hdr-glow 2s ease-in-out infinite alternate}
@keyframes hdr-glow{0%{box-shadow:0 0 8px var(--cyan),0 0 16px rgba(6,182,212,.3)}100%{box-shadow:0 0 14px var(--cyan),0 0 28px rgba(6,182,212,.5)}}
.hdr-sub{font-size:12px;color:var(--t3);letter-spacing:4px;text-transform:uppercase;font-weight:500;margin-top:20px;font-family:var(--fm)}

/* Stats bar */
.stats{display:flex;justify-content:center;gap:16px;margin-top:28px;flex-wrap:wrap}
.stat{background:var(--bg3);border:1px solid var(--bdr);border-radius:var(--r);padding:14px 24px;text-align:center;min-width:150px;transition:var(--tr)}
.stat:hover{border-color:var(--bdr2);transform:translateY(-2px);box-shadow:0 4px 20px rgba(0,0,0,.3)}
.stat-val{font-size:22px;font-weight:800;font-family:var(--fm);letter-spacing:-1px}
.stat-lbl{font-size:11px;color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;margin-top:2px;font-family:var(--fm)}

/* Tabs */
.tabs{display:flex;justify-content:center;gap:6px;margin-top:28px;flex-wrap:wrap}
.tab-btn{padding:10px 24px;border-radius:8px;background:transparent;border:1px solid var(--bdr);color:var(--t2);font-size:13px;font-family:var(--fd);font-weight:600;cursor:pointer;transition:var(--tr);white-space:nowrap}
.tab-btn:hover{color:var(--t1);background:var(--bg4);border-color:var(--bdr2)}
.tab-btn.active{color:var(--blue);background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.3)}
.tab-content{display:none;padding:40px 0}
.tab-content.active{display:block}

/* SVG container */
.svg-wrap{position:relative;background:var(--bg2);border:1px solid var(--bdr);border-radius:12px;overflow:hidden;margin-top:24px}
.svg-wrap svg{display:block;width:100%;cursor:grab}
.svg-wrap svg:active{cursor:grabbing}

/* Zoom controls */
.zoom-ctrl{position:absolute;top:12px;right:12px;display:flex;flex-direction:column;gap:4px;z-index:10}
.zoom-btn{width:32px;height:32px;border-radius:6px;background:var(--bg3);border:1px solid var(--bdr);color:var(--t2);font-size:16px;font-family:var(--fm);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.zoom-btn:hover{background:var(--bg4);color:var(--t1);border-color:var(--bdr2)}

/* Detail panel */
.detail-panel{position:fixed;top:0;right:-360px;width:340px;height:100vh;background:var(--bg2);border-left:1px solid var(--bdr);z-index:1000;padding:24px;overflow-y:auto;transition:right .35s cubic-bezier(0.4,0,0.2,1);box-shadow:-8px 0 40px rgba(0,0,0,.5)}
.detail-panel.open{right:0}
.detail-close{position:absolute;top:16px;right:16px;width:28px;height:28px;border-radius:6px;background:var(--bg3);border:1px solid var(--bdr);color:var(--t2);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.detail-close:hover{background:var(--bg4);color:var(--t1)}
.detail-panel .dp-id{font-family:var(--fm);font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px}
.detail-panel .dp-title{font-size:20px;font-weight:700;letter-spacing:-.3px;margin-bottom:6px}
.detail-panel .dp-full{font-size:13px;color:var(--t2);margin-bottom:16px}
.detail-panel .dp-section{margin-bottom:16px}
.detail-panel .dp-label{font-size:10px;font-family:var(--fm);color:var(--t3);text-transform:uppercase;letter-spacing:2px;font-weight:600;margin-bottom:6px}
.detail-panel .dp-text{font-size:13px;color:var(--t2);line-height:1.7}
.detail-panel .dp-badge{display:inline-block;padding:3px 10px;border-radius:6px;font-size:11px;font-family:var(--fm);font-weight:600;margin-right:6px;margin-bottom:4px}
.dp-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:999;opacity:0;pointer-events:none;transition:opacity .3s}
.dp-overlay.open{opacity:1;pointer-events:auto}

/* Legend */
.legend{display:flex;justify-content:center;gap:20px;margin-top:16px;flex-wrap:wrap}
.legend-item{display:flex;align-items:center;gap:6px;font-size:11px;font-family:var(--fm);color:var(--t3)}
.legend-dot{width:10px;height:10px;border-radius:3px}

/* Tab 2 & 3 shared */
.section-title{font-size:11px;font-family:var(--fm);color:var(--t3);text-transform:uppercase;letter-spacing:2.5px;font-weight:600;margin-bottom:8px}
.section-heading{font-size:clamp(20px,2.5vw,28px);font-weight:700;letter-spacing:-.5px;margin-bottom:16px}
.section-desc{font-size:14px;color:var(--t2);max-width:700px;margin-bottom:24px;line-height:1.7}
.section-block{margin-bottom:48px}

/* Cards grid */
.g2{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:14px}
.g3{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.g5{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
.card{background:var(--bg3);border:1px solid var(--bdr);border-radius:var(--r);padding:20px;transition:var(--tr)}
.card:hover{border-color:var(--bdr2);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.3)}
.card h4{font-size:14px;font-weight:700;margin-bottom:4px}
.card p{font-size:12.5px;color:var(--t2);line-height:1.65;margin-top:4px}
.card .card-num{font-size:28px;font-weight:900;font-family:var(--fm);opacity:.15;position:absolute;top:12px;right:16px}
.card-rel{position:relative;overflow:hidden}

/* Pool visual */
.pool-visual{display:flex;align-items:center;justify-content:center;gap:32px;padding:40px 0;flex-wrap:wrap}
.pool-circle{border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column;font-family:var(--fm);font-weight:800;position:relative}
.pool-big{width:160px;height:160px;background:rgba(59,130,246,.1);border:2px solid rgba(59,130,246,.3);font-size:40px;color:var(--blue)}
.pool-big span{font-size:11px;font-weight:500;color:var(--t3);margin-top:2px}
.pool-small{width:100px;height:100px;background:rgba(16,185,129,.1);border:2px solid rgba(16,185,129,.3);font-size:28px;color:var(--green)}
.pool-small span{font-size:10px;font-weight:500;color:var(--t3);margin-top:2px}
.pool-funnel{font-size:32px;color:var(--t3);animation:funnel-pulse 2s ease-in-out infinite}
@keyframes funnel-pulse{0%,100%{opacity:.4}50%{opacity:1}}

/* Layer stack */
.layer-stack{display:flex;flex-direction:column;gap:8px}
.layer{padding:18px 24px;border-radius:var(--r);border:1px solid;position:relative;padding-left:56px}
.layer::before{content:attr(data-num);position:absolute;left:18px;top:50%;transform:translateY(-50%);font-size:18px;font-weight:900;font-family:var(--fm);opacity:.3}
.layer h4{font-size:13px;font-weight:700;margin-bottom:2px}
.layer p{font-size:12px;color:var(--t2);line-height:1.5}
.l-blue{background:rgba(59,130,246,.06);border-color:rgba(59,130,246,.2)}.l-blue h4{color:var(--blue)}
.l-cyan{background:rgba(6,182,212,.06);border-color:rgba(6,182,212,.2)}.l-cyan h4{color:var(--cyan)}
.l-violet{background:rgba(139,92,246,.06);border-color:rgba(139,92,246,.2)}.l-violet h4{color:var(--violet)}
.l-amber{background:rgba(245,158,11,.06);border-color:rgba(245,158,11,.2)}.l-amber h4{color:var(--amber)}

/* Flow row */
.flow-row{display:flex;align-items:center;gap:0;overflow-x:auto;padding:16px 0;flex-wrap:nowrap}
.flow-node{min-width:120px;padding:14px 16px;border-radius:var(--r);text-align:center;font-size:12px;font-weight:600;border:1px solid;flex-shrink:0}
.flow-arr{color:var(--t3);font-size:18px;flex-shrink:0;padding:0 6px}
.fn-blue{background:rgba(59,130,246,.1);border-color:rgba(59,130,246,.25);color:var(--blue)}
.fn-cyan{background:rgba(6,182,212,.1);border-color:rgba(6,182,212,.25);color:var(--cyan)}
.fn-green{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.25);color:var(--green)}
.fn-amber{background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.25);color:var(--amber)}
.fn-violet{background:rgba(139,92,246,.1);border-color:rgba(139,92,246,.25);color:var(--violet)}
.fn-rose{background:rgba(244,63,94,.1);border-color:rgba(244,63,94,.25);color:var(--rose)}

/* Table */
table{width:100%;border-collapse:separate;border-spacing:0;border-radius:var(--r);overflow:hidden;border:1px solid var(--bdr);font-size:13px;margin:16px 0}
th{background:var(--bg4);padding:10px 14px;text-align:left;font-size:11px;font-family:var(--fm);color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;font-weight:600;border-bottom:1px solid var(--bdr)}
td{padding:10px 14px;border-bottom:1px solid var(--bdr);color:var(--t2)}
tr:last-child td{border-bottom:0}
tr:hover{background:rgba(255,255,255,.02)}
.badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-family:var(--fm);font-weight:600}
.bb{background:rgba(59,130,246,.15);color:var(--blue)}
.bc{background:rgba(6,182,212,.15);color:var(--cyan)}
.bv{background:rgba(139,92,246,.15);color:var(--violet)}
.ba{background:rgba(245,158,11,.15);color:var(--amber)}
.bg{background:rgba(16,185,129,.15);color:var(--green)}

/* Split columns */
.split{display:grid;grid-template-columns:1fr 1fr;gap:24px}
.split-col{background:var(--bg3);border:1px solid var(--bdr);border-radius:var(--r);padding:24px}
.split-col h4{font-size:14px;font-weight:700;margin-bottom:12px}
.split-col ul{list-style:none;padding:0}
.split-col li{font-size:12.5px;color:var(--t2);padding:6px 0;border-bottom:1px solid var(--bdr);display:flex;align-items:center;gap:8px}
.split-col li:last-child{border-bottom:0}
.split-col li::before{content:'';width:6px;height:6px;border-radius:50%;flex-shrink:0}

/* Source cards */
.source-card{position:relative;overflow:hidden}
.source-card .s-type{font-size:10px;font-family:var(--fm);font-weight:600;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:4px;display:inline-block;margin-bottom:8px}
.s-free{background:rgba(16,185,129,.12);color:var(--green)}
.s-paid{background:rgba(245,158,11,.12);color:var(--amber)}
.s-mixed{background:rgba(139,92,246,.12);color:var(--violet)}

/* Time estimate card */
.time-card{background:var(--bg3);border:1px solid var(--bdr);border-radius:var(--r);padding:32px;text-align:center}
.time-val{font-size:48px;font-weight:900;font-family:var(--fm);letter-spacing:-2px}
.time-lbl{font-size:12px;color:var(--t3);text-transform:uppercase;letter-spacing:2px;font-family:var(--fm);margin-top:4px}

/* Footer */
.footer{padding:40px 0;border-top:1px solid var(--bdr);text-align:center;color:var(--t3);font-size:12px;font-family:var(--fm);margin-top:40px}

@media(max-width:768px){
  .container{padding:0 16px}
  .g2,.g3,.g5{grid-template-columns:1fr}
  .stats{flex-direction:column;align-items:center}
  .split{grid-template-columns:1fr}
  .flow-row{flex-wrap:wrap;justify-content:center}
  .detail-panel{width:100%}
}
</style>
</head>
<body>
<div class="bgx"></div>

<div class="container">
  <!-- Header -->
  <div class="hdr">
    <h1>PayArk</h1>
    <div class="hdr-sub">From Zero to Payment Architect</div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat"><div class="stat-val" style="color:var(--blue)">44</div><div class="stat-lbl">Modules</div></div>
      <div class="stat"><div class="stat-val" style="color:var(--cyan)">4</div><div class="stat-lbl">Certifications</div></div>
      <div class="stat"><div class="stat-val" style="color:var(--violet)">32</div><div class="stat-lbl">Weeks</div></div>
      <div class="stat"><div class="stat-val" style="color:var(--amber)">1,500+</div><div class="stat-lbl">Questions</div></div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('cert')">Certification Path</button>
      <button class="tab-btn" onclick="switchTab('exam')">Exam Model</button>
      <button class="tab-btn" onclick="switchTab('pipeline')">Content Pipeline</button>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- TAB 1: Certification Path (D3 Skill Tree) -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="tab-content active" id="tab-cert">
    <div class="legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div>PAKF — Foundations</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--cyan)"></div>PAKE — Platform Engineer</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--violet)"></div>PAKSA — Systems Architect</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--amber)"></div>PAKA — Capstone</div>
    </div>
    <div class="svg-wrap" id="tree-container">
      <div class="zoom-ctrl">
        <button class="zoom-btn" id="zoomIn" title="Zoom In">+</button>
        <button class="zoom-btn" id="zoomOut" title="Zoom Out">&minus;</button>
        <button class="zoom-btn" id="zoomReset" title="Reset" style="font-size:11px">R</button>
      </div>
      <svg id="skill-tree"></svg>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- TAB 2: Exam Model                          -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="tab-content" id="tab-exam">

    <!-- Question Bank -->
    <div class="section-block">
      <div class="section-title">Question Strategy</div>
      <div class="section-heading">5x Question Pool</div>
      <div class="section-desc">For every 60-question exam, the bank holds 300 questions. Memorizing all 300 means learning the material.</div>
      <div class="pool-visual">
        <div class="pool-circle pool-big">300<span>Pool Size</span></div>
        <div class="pool-funnel">&raquo;</div>
        <div class="pool-circle pool-small">60<span>Per Exam</span></div>
      </div>
    </div>

    <!-- Randomization Engine -->
    <div class="section-block">
      <div class="section-title">Integrity Engine</div>
      <div class="section-heading">Randomization Rules</div>
      <div class="g5">
        <div class="card card-rel"><div class="card-num" style="color:var(--blue)">01</div><h4 style="color:var(--blue)">Random Selection</h4><p>Unique seed per attempt. Never the same question set twice.</p></div>
        <div class="card card-rel"><div class="card-num" style="color:var(--cyan)">02</div><h4 style="color:var(--cyan)">Answer Shuffling</h4><p>A/B/C/D positions randomized on every single attempt.</p></div>
        <div class="card card-rel"><div class="card-num" style="color:var(--violet)">03</div><h4 style="color:var(--violet)">Weighted Retry</h4><p>Previously wrong answers reappear more often on retakes.</p></div>
        <div class="card card-rel"><div class="card-num" style="color:var(--green)">04</div><h4 style="color:var(--green)">Category Coverage</h4><p>15% Kafka, 20% DDD, etc. Guaranteed topic spread every time.</p></div>
        <div class="card card-rel"><div class="card-num" style="color:var(--amber)">05</div><h4 style="color:var(--amber)">Difficulty Spread</h4><p>30% easy, 50% medium, 20% hard. Consistent every attempt.</p></div>
      </div>
    </div>

    <!-- Anti-Cheat Layers -->
    <div class="section-block">
      <div class="section-title">Security</div>
      <div class="section-heading">Anti-Cheat Layers</div>
      <div class="layer-stack">
        <div class="layer l-blue" data-num="1"><h4>Layer 1 &mdash; Structural</h4><p>300-question pool per exam. Encrypted question database. No two exams are alike.</p></div>
        <div class="layer l-cyan" data-num="2"><h4>Layer 2 &mdash; Temporal</h4><p>Per-question timer. No back-navigation. 48-hour cooldown between attempts.</p></div>
        <div class="layer l-violet" data-num="3"><h4>Layer 3 &mdash; Feedback</h4><p>Correct answers are never shown. Only category-level weakness reports.</p></div>
        <div class="layer l-amber" data-num="4"><h4>Layer 4 &mdash; Ultimate</h4><p>Level 4 certification requires building a real project. No exam to cheat on.</p></div>
      </div>
    </div>

    <!-- Exam Session Flow -->
    <div class="section-block">
      <div class="section-title">Process</div>
      <div class="section-heading">Exam Session Flow</div>
      <div class="flow-row">
        <div class="flow-node fn-blue"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">BANK</div>Pool</div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-cyan"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">SELECT</div>Random 60</div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-violet"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">SHUFFLE</div>Options</div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-amber"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">EXAM</div>Timed</div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-green"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">SCORE</div>Auto-Grade</div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-rose"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">RESULT</div>Pass / Fail</div>
      </div>
    </div>

    <!-- Certification Exams Table -->
    <div class="section-block">
      <div class="section-title">Certifications</div>
      <div class="section-heading">Exam Requirements</div>
      <table>
        <thead><tr><th>Level</th><th>Cert</th><th>Questions</th><th>Time</th><th>Format</th><th>Pass</th></tr></thead>
        <tbody>
          <tr><td><span class="badge bb">Level 1</span></td><td style="color:var(--blue);font-weight:700;font-family:var(--fm)">PAKF</td><td>60 MCQ</td><td>90 min</td><td>Multiple choice, scenario-based</td><td style="font-family:var(--fm);font-weight:700">70%</td></tr>
          <tr><td><span class="badge bc">Level 2</span></td><td style="color:var(--cyan);font-weight:700;font-family:var(--fm)">PAKE</td><td>80 MCQ</td><td>120 min</td><td>MCQ + code reading + diagrams</td><td style="font-family:var(--fm);font-weight:700">70%</td></tr>
          <tr><td><span class="badge bv">Level 3</span></td><td style="color:var(--violet);font-weight:700;font-family:var(--fm)">PAKSA</td><td>60 MCQ + 1 design</td><td>180 min</td><td>MCQ + written system design</td><td style="font-family:var(--fm);font-weight:700">75%</td></tr>
          <tr><td><span class="badge ba">Level 4</span></td><td style="color:var(--amber);font-weight:700;font-family:var(--fm)">PAKA</td><td>3-layer assessment</td><td>N/A</td><td>Auto gates + AI review + architecture doc</td><td style="font-family:var(--fm);font-weight:700">75%</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <!-- ═══════════════════════════════════════════ -->
  <!-- TAB 3: Content Pipeline                     -->
  <!-- ═══════════════════════════════════════════ -->
  <div class="tab-content" id="tab-pipeline">

    <!-- Content Sources -->
    <div class="section-block">
      <div class="section-title">Sources</div>
      <div class="section-heading">Content Sources</div>
      <div class="section-desc">Curated from the best free and paid platforms, mapped to every module.</div>
      <div class="g5">
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>YouTube</h4><p>Curated playlists per module. Embedded with timestamps.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>Confluent Developer</h4><p>Official Apache Kafka training and certification prep.</p></div>
        <div class="card source-card"><span class="s-type s-mixed">Free + Paid</span><h4>Spring Academy</h4><p>Official Spring Boot and Spring Framework courses.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>Redis University</h4><p>RU101, RU201 courses. Caching and data structures.</p></div>
        <div class="card source-card"><span class="s-type s-paid">Paid ~$15</span><h4>Udemy</h4><p>Deep courses where free content is insufficient.</p></div>
        <div class="card source-card"><span class="s-type s-mixed">Free + Pro</span><h4>Baeldung</h4><p>Java and Spring written tutorials and guides.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>IBM Developer</h4><p>IBM MQ, integration patterns, enterprise messaging.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>SWIFT Learning</h4><p>ISO 20022 standards, message formats, migration.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>HashiCorp Learn</h4><p>Vault secrets management, Consul service mesh.</p></div>
        <div class="card source-card"><span class="s-type s-free">Free</span><h4>Kubernetes.io</h4><p>Official K8s tutorials, documentation, labs.</p></div>
      </div>
    </div>

    <!-- Integration Strategy -->
    <div class="section-block">
      <div class="section-title">Strategy</div>
      <div class="section-heading">Integration Model</div>
      <div class="split">
        <div class="split-col" style="border-left:3px solid var(--green)">
          <h4 style="color:var(--green)">Embedded (In-App)</h4>
          <ul>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;flex-shrink:0"></span>YouTube videos with timestamps</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;flex-shrink:0"></span>AI-generated content</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;flex-shrink:0"></span>Automatic progress tracking</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block;flex-shrink:0"></span>Inline quizzes after sections</li>
          </ul>
        </div>
        <div class="split-col" style="border-left:3px solid var(--amber)">
          <h4 style="color:var(--amber)">External (Link-Out)</h4>
          <ul>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--amber);display:inline-block;flex-shrink:0"></span>Udemy courses</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--amber);display:inline-block;flex-shrink:0"></span>Confluent Developer portal</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--amber);display:inline-block;flex-shrink:0"></span>Spring Academy, Redis University</li>
            <li style="color:var(--t2)"><span style="width:6px;height:6px;border-radius:50%;background:var(--amber);display:inline-block;flex-shrink:0"></span>Manual "Mark Complete" button</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Production Pipeline -->
    <div class="section-block">
      <div class="section-title">Pipeline</div>
      <div class="section-heading">Per-Module Production Pipeline</div>
      <div class="flow-row">
        <div class="flow-node fn-blue" style="min-width:140px"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">STEP 1</div>Claude Code<div style="font-size:10px;color:var(--t3);margin-top:4px">Outline + Curate + Lab + Quiz</div></div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-cyan" style="min-width:140px"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">STEP 2</div>Builder Review<div style="font-size:10px;color:var(--t3);margin-top:4px">Review + Study</div></div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-violet" style="min-width:140px"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">STEP 3</div>AI Video<div style="font-size:10px;color:var(--t3);margin-top:4px">Synthesia / HeyGen</div></div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-amber" style="min-width:140px"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">STEP 4</div>YouTube<div style="font-size:10px;color:var(--t3);margin-top:4px">Embedded + Timestamps</div></div>
        <div class="flow-arr">&rarr;</div>
        <div class="flow-node fn-green" style="min-width:140px"><div style="font-size:10px;font-family:var(--fm);opacity:.6;margin-bottom:2px">STEP 5</div>App Publish<div style="font-size:10px;color:var(--t3);margin-top:4px">Module live</div></div>
      </div>
    </div>

    <!-- Time Estimates -->
    <div class="section-block">
      <div class="section-title">Estimates</div>
      <div class="section-heading">Time Investment</div>
      <div class="g3">
        <div class="time-card"><div class="time-val" style="color:var(--cyan)">~1.5</div><div class="time-lbl">Hrs / Module (Builder)</div></div>
        <div class="time-card"><div class="time-val" style="color:var(--blue)">~66</div><div class="time-lbl">Total Hours (Builder)</div></div>
        <div class="time-card"><div class="time-val" style="color:var(--violet)">~2-3</div><div class="time-lbl">Hrs / Module (Claude Code)</div></div>
      </div>
    </div>

  </div>

  <div class="footer">PayArk Training Academy &mdash; Payment House Project &mdash; 2026</div>
</div>

<!-- Detail Panel -->
<div class="dp-overlay" id="dpOverlay" onclick="closeDetail()"></div>
<div class="detail-panel" id="detailPanel">
  <button class="detail-close" onclick="closeDetail()">&times;</button>
  <div id="dp-content"></div>
</div>

<script>
/* ═══════════════════════════════════════════════════
   MODULE DATA
   ═══════════════════════════════════════════════════ */
const modules = [
  // Level 1 — PAKF — Blue — 12 modules
  {id:"M01",short:"Payments 101",title:"How Payments Work",level:1,week:1,topics:"Payment lifecycle, clearing vs settlement, RTGS vs DNS, correspondent banking, nostro/vostro",handsOn:"Map a real SWIFT MT103 message field by field",payonex:"Domain knowledge (all tiers)"},
  {id:"M02",short:"ISO 20022",title:"ISO 20022 Decoded",level:1,week:1,topics:"MX messages, pain.001, pacs.008, pacs.002, XML schema, MT to MX migration",handsOn:"Parse a real pacs.008 XML, extract key fields",payonex:"Domain knowledge (all tiers)"},
  {id:"M03",short:"Clearing Houses",title:"Clearing Houses Around the World",level:1,week:2,topics:"MEPS+, FAST, CHATS, FPS, CHAPS, RTGS India, NEFT, UPI, SWIFT gpi, operating hours, cutoffs",handsOn:"Build a clearing house config matrix from scratch",payonex:"Domain knowledge (all tiers)"},
  {id:"M04",short:"Compliance",title:"Compliance & Screening",level:1,week:2,topics:"Sanctions (OFAC/EU/UN), AML, PEP, fraud detection, investigation workflows, STR reporting",handsOn:"Design a screening decision tree for a sample payment",payonex:"Domain knowledge (all tiers)"},
  {id:"M05",short:"Java 21",title:"Java 21 for Payment Systems",level:1,week:3,topics:"Records, sealed classes, virtual threads, pattern matching, BigDecimal, immutability",handsOn:"Refactor a mutable Payment class to immutable Java record",payonex:"Code quality (all services)"},
  {id:"M06",short:"SOLID",title:"SOLID Principles Applied",level:1,week:3,topics:"SRP, OCP, LSP, ISP, DIP with payment domain examples",handsOn:"Identify SOLID violations in a sample payment codebase",payonex:"Code quality (all services)"},
  {id:"M07",short:"CUPID",title:"CUPID + Financial Disciplines",level:1,week:4,topics:"Predictability, domain alignment, defensive calculations, auditability",handsOn:"Write a routing decision that carries its own audit trail",payonex:"Code quality (all services)"},
  {id:"M08",short:"Strategy Pattern",title:"Design Patterns I",level:1,week:4,topics:"Strategy pattern (clearing adapters), Template Method (processing pipeline)",handsOn:"Build a mini clearing adapter system with 3 adapters",payonex:"Code quality (all services)"},
  {id:"M09",short:"State Machine",title:"Design Patterns II",level:1,week:5,topics:"Composable business rules, payment state machine, guard conditions",handsOn:"Implement a payment state machine with valid transitions",payonex:"Code quality (all services)"},
  {id:"M10",short:"Hexagonal",title:"Hexagonal Architecture",level:1,week:5,topics:"Ports & adapters, domain isolation, zero framework imports in domain/",handsOn:"Restructure a Spring app into hexagonal layers",payonex:"Code quality (all services)"},
  {id:"M11",short:"DDD",title:"Domain-Driven Design",level:1,week:6,topics:"Bounded contexts, aggregates, entities, value objects, ubiquitous language",handsOn:"Map the 6 Payment House bounded contexts",payonex:"Code quality (all services)"},
  {id:"M12",short:"12-Factor",title:"Twelve-Factor App",level:1,week:6,topics:"Config in env, stateless processes, port binding, dev/prod parity, logs as streams",handsOn:"12-factor compliance audit on a sample app",payonex:"Code quality (all services)"},

  // Level 2 — PAKE — Cyan — 16 modules
  {id:"M13",short:"Kafka Basics",title:"Apache Kafka Fundamentals",level:2,week:7,topics:"Producers, consumers, consumer groups, partitions, replication, retention",handsOn:"Set up Kafka locally, produce/consume payment messages",payonex:"Kafka backbone (Tiers 1-6)"},
  {id:"M14",short:"Kafka Deep",title:"Kafka Deep Dive",level:2,week:7,topics:"Exactly-once semantics, transactions, idempotent producers, compaction, topic design",handsOn:"Design the 10 Payment House Kafka topics",payonex:"Kafka backbone (Tiers 1-6)"},
  {id:"M15",short:"Kafka Streams",title:"Kafka Streams & Real-Time",level:2,week:8,topics:"Stream processing, materialized views, windowing, aggregations",handsOn:"Build a real-time payment volume dashboard from Kafka Streams",payonex:"Kafka backbone (Tiers 1-6)"},
  {id:"M16",short:"Spring Boot",title:"Spring Boot for Payment Systems",level:2,week:8,topics:"Profiles, externalized config, actuator, health checks, dependency injection",handsOn:"Multi-profile Spring app with region-specific configs",payonex:"Spring Boot services (all tiers)"},
  {id:"M17",short:"Spring Kafka",title:"Spring Kafka Integration",level:2,week:9,topics:"Spring Kafka listeners, producers, error handlers, DLQ routing",handsOn:"End-to-end Kafka producer/consumer with retry",payonex:"Spring Boot services (all tiers)"},
  {id:"M18",short:"PostgreSQL",title:"PostgreSQL for Finance",level:2,week:9,topics:"ACID, isolation levels, partitioning, indexing, pg_stat_statements",handsOn:"Design the payment_master schema with monthly partitions",payonex:"Databases (per-service)"},
  {id:"M19",short:"Citus",title:"Horizontal Sharding",level:2,week:10,topics:"Distributed PostgreSQL, shard key selection, distributed queries",handsOn:"Shard the ledger_db by account ID",payonex:"Databases (per-service)"},
  {id:"M20",short:"Redis",title:"Redis for Payment Systems",level:2,week:10,topics:"Caching, deduplication (TTL 7d), idempotency store, pub/sub",handsOn:"Build a Redis-backed deduplication gateway",payonex:"Redis layer (Tier 1 dedup)"},
  {id:"M21",short:"ClickHouse",title:"ClickHouse Analytics",level:2,week:11,topics:"Columnar storage, MergeTree, materialized views, aggregation queries",handsOn:"Load 1M payment records, write analytical queries",payonex:"ClickHouse (Tier 6 reporting)"},
  {id:"M22",short:"Outbox + CDC",title:"Transactional Outbox + Debezium",level:2,week:11,topics:"CDC, WAL capture, outbox table design, exactly-once to Kafka",handsOn:"Implement outbox pattern with Debezium + PostgreSQL",payonex:"Outbox pattern (all producers)"},
  {id:"M23",short:"Event Sourcing",title:"Event Sourcing in Practice",level:2,week:12,topics:"Immutable events, event store, state reconstruction, snapshots",handsOn:"Build an event-sourced payment aggregate",payonex:"Event sourcing (all tiers)"},
  {id:"M24",short:"Saga Pattern",title:"Distributed Transactions",level:2,week:12,topics:"5-step accounting saga, compensating transactions, saga log",handsOn:"Implement the accounting saga with failure compensation",payonex:"Saga (Tier 5 accounting)"},
  {id:"M25",short:"ACL",title:"Anti-Corruption Layer",level:2,week:13,topics:"Per clearing house ACL, external format translation, domain protection",handsOn:"Build ACL for a simulated SWIFT response format",payonex:"ACL (Tier 4 clearing)"},
  {id:"M26",short:"Circuit Breaker",title:"Resilience",level:2,week:13,topics:"Resilience4j, 3-state breaker, 3-tier DLQ, retry with backoff, bulkhead",handsOn:"Simulate clearing house failures with circuit breaker recovery",payonex:"Resilience (Tier 4)"},
  {id:"M27",short:"REST + gRPC",title:"API Design",level:2,week:14,topics:"API Gateway, rate limiting, protocol translation, Protobuf",handsOn:"Build a dual REST/gRPC payment submission API",payonex:"API layer (Tier 1 ingestion)"},
  {id:"M28",short:"Testing",title:"Testing Strategies",level:2,week:14,topics:"Unit (AAA), integration (Testcontainers), contract, E2E, chaos, performance",handsOn:"Write test suites for a clearing adapter with >90% coverage",payonex:"Testing (all tiers)"},

  // Level 3 — PAKSA — Violet — 16 modules
  {id:"M29",short:"Docker",title:"Docker for Payment Microservices",level:3,week:15,topics:"Multi-stage builds, single image strategy, optimization, Docker Compose",handsOn:"Dockerize 3 payment microservices + Kafka + PG",payonex:"Infrastructure (K8s, Istio)"},
  {id:"M30",short:"K8s Basics",title:"Kubernetes Fundamentals",level:3,week:15,topics:"Pods, Deployments, Services, ConfigMaps, Secrets, HPA, PDB",handsOn:"Deploy payment services to a local K8s cluster",payonex:"Infrastructure (K8s, Istio)"},
  {id:"M31",short:"K8s Advanced",title:"Kubernetes Advanced",level:3,week:16,topics:"StatefulSets (Kafka), network policies, RBAC, resource limits, affinity",handsOn:"Production-grade K8s manifests for Payment House",payonex:"Infrastructure (K8s, Istio)"},
  {id:"M32",short:"Istio",title:"Service Mesh",level:3,week:16,topics:"mTLS, traffic management, canary deployments, fault injection, Kiali",handsOn:"Canary deploy a clearing adapter with 95/5 traffic split",payonex:"Infrastructure (K8s, Istio)"},
  {id:"M33",short:"Vault",title:"HashiCorp Vault",level:3,week:17,topics:"Dynamic secrets, auto-rotation, encryption-as-a-service, policies",handsOn:"Vault-managed database credentials for payment services",payonex:"Secrets & config (cross-cutting)"},
  {id:"M34",short:"Consul",title:"Consul/etcd for Config",level:3,week:17,topics:"Distributed config, hot-reload, service discovery, country configs",handsOn:"Hot-reload clearing house cutoff times without restart",payonex:"Secrets & config (cross-cutting)"},
  {id:"M35",short:"Prometheus",title:"Prometheus + Grafana",level:3,week:18,topics:"Custom metrics, PromQL, golden signals, alerting rules, Thanos",handsOn:"Build a Payment House operations dashboard",payonex:"Observability (cross-cutting)"},
  {id:"M36",short:"OpenTelemetry",title:"Distributed Tracing",level:3,week:18,topics:"Span propagation, Jaeger, trace sampling, correlation IDs",handsOn:"Trace a payment end-to-end across 6 services",payonex:"Observability (cross-cutting)"},
  {id:"M37",short:"ELK Stack",title:"Structured Logging",level:3,week:19,topics:"Structured JSON logs, MDC correlation ID, Filebeat, Logstash, Kibana",handsOn:"Centralized logging with payment correlation search",payonex:"Observability (cross-cutting)"},
  {id:"M38",short:"Self-Healing",title:"Self-Healing Infrastructure",level:3,week:19,topics:"K8s probes, anomaly detection, auto-scaling, DLQ auto-replay",handsOn:"Simulate failures, verify auto-recovery",payonex:"Self-healing (cross-cutting)"},
  {id:"M39",short:"Multi-Region",title:"Multi-Region Deployment",level:3,week:20,topics:"MirrorMaker 2, cross-region replication, RPO/RTO, DR failover",handsOn:"Set up 2-region Kafka replication with failover test",payonex:"Multi-region (deployment)"},
  {id:"M40",short:"Security",title:"Security Architecture",level:3,week:21,topics:"TLS 1.3, field-level encryption, PII protection, RBAC, Kafka ACLs",handsOn:"Encrypt PII fields in payment messages with Vault KEKs",payonex:"Security (cross-cutting)"},
  {id:"M41",short:"CI/CD",title:"CI/CD Pipeline",level:3,week:22,topics:"GitLab CI, ArgoCD, GitOps, conventional commits, semantic versioning",handsOn:"Build a full CI/CD pipeline for a payment microservice",payonex:"CI/CD pipeline"},
  {id:"M42",short:"Performance",title:"Performance Engineering",level:3,week:23,topics:"Load testing (Gatling/k6), p99 tuning, JVM optimization, connection pools",handsOn:"Load test the ingestion gateway to 10K msg/s",payonex:"Performance (SLA targets)"},
  {id:"M43",short:"Regulatory",title:"Regulatory Compliance & Reporting",level:3,week:24,topics:"LVT reports, STR filing, EOD reconciliation, 7-year archive, audit",handsOn:"Build an automated reconciliation engine",payonex:"Regulatory (Tier 6 reporting)"},
  {id:"M44",short:"System Design",title:"System Design: Payment Platform",level:3,week:24,topics:"Full system design exercise: whiteboard the complete Payment House",handsOn:"Design document: 6-tier architecture from scratch",payonex:"Full architecture"},

  // Level 4 — PAKA — Amber — 4 sprints
  {id:"S1",short:"Kafka + Ingestion",title:"Sprint 1: Kafka + Ingestion Gateway",level:4,week:"25-26",topics:"Kafka cluster setup, Ingestion Gateway, IBM MQ bridge, deduplication",handsOn:"Kafka cluster + Ingestion Gateway with IBM MQ bridge + dedup",payonex:"Tiers 1-2 (Ingestion + Processing)"},
  {id:"S2",short:"Processor + DB",title:"Sprint 2: Message Processor + DB",level:4,week:"27-28",topics:"Message Processor, Enrichment service, Payment Master DB schema",handsOn:"Message Processor + Enrichment + Payment Master DB",payonex:"Tiers 2-3 (Processing + Enrichment)"},
  {id:"S3",short:"Compliance + Clearing",title:"Sprint 3: Compliance + Clearing",level:4,week:"29-30",topics:"Compliance screening (mock), Clearing adapter, Circuit breaker",handsOn:"Compliance screening + Clearing adapter (1 country) + Circuit breaker",payonex:"Tiers 3-4 (Compliance + Clearing)"},
  {id:"S4",short:"Saga + Reporting",title:"Sprint 4: Saga + Reporting",level:4,week:"31-32",topics:"Accounting saga, Reporting dashboard, E2E testing, Observability",handsOn:"Accounting saga + Reporting dashboard + E2E test + Observability",payonex:"Tiers 5-6 (Accounting + Reporting)"}
];

const levelConfig = {
  1: {name:"PAKF",label:"Payment Foundations",color:"#3b82f6",modules:12,weeks:"6 weeks",exam:"60 MCQ, 90 min, Pass: 70%"},
  2: {name:"PAKE",label:"Platform Engineer",color:"#06b6d4",modules:16,weeks:"8 weeks",exam:"80 MCQ, 120 min, Pass: 70%"},
  3: {name:"PAKSA",label:"Systems Architect",color:"#8b5cf6",modules:16,weeks:"10 weeks",exam:"60 MCQ + 1 design, 180 min, Pass: 75%"},
  4: {name:"PAKA",label:"Capstone Build",color:"#f59e0b",modules:4,weeks:"8 weeks",exam:"3-layer assessment, Pass: 75%"}
};

/* ═══════════════════════════════════════════════════
   TAB SWITCHING
   ═══════════════════════════════════════════════════ */
function switchTab(id) {
  document.querySelectorAll('.tab-btn').forEach((b,i) => {
    b.classList.toggle('active', ['cert','exam','pipeline'][i] === id);
  });
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + id).classList.add('active');
  if (id === 'cert') setTimeout(() => renderTree(), 50);
}

/* ═══════════════════════════════════════════════════
   DETAIL PANEL
   ═══════════════════════════════════════════════════ */
function openDetail(mod) {
  const lc = levelConfig[mod.level];
  const html = `
    <div class="dp-id" style="color:${lc.color}">${mod.id} &mdash; ${lc.name}</div>
    <div class="dp-title">${mod.short}</div>
    <div class="dp-full">${mod.title}</div>
    <div class="dp-section">
      <div class="dp-badge" style="background:${lc.color}22;color:${lc.color}">Level ${mod.level}</div>
      <div class="dp-badge" style="background:var(--bg4);color:var(--t2)">Week ${mod.week}</div>
    </div>
    <div class="dp-section">
      <div class="dp-label">Topics</div>
      <div class="dp-text">${mod.topics}</div>
    </div>
    <div class="dp-section">
      <div class="dp-label">Hands-On Project</div>
      <div class="dp-text" style="color:${lc.color}">${mod.handsOn}</div>
    </div>
    <div class="dp-section">
      <div class="dp-label">PayoneX Component</div>
      <div class="dp-text">${mod.payonex}</div>
    </div>
  `;
  document.getElementById('dp-content').innerHTML = html;
  document.getElementById('detailPanel').classList.add('open');
  document.getElementById('dpOverlay').classList.add('open');
}

function closeDetail() {
  document.getElementById('detailPanel').classList.remove('open');
  document.getElementById('dpOverlay').classList.remove('open');
}

/* ═══════════════════════════════════════════════════
   D3.js SKILL TREE
   ═══════════════════════════════════════════════════ */
let treeRendered = false;

function renderTree() {
  if (treeRendered) return;
  treeRendered = true;

  const W = 1300, H = 920;
  const svg = d3.select('#skill-tree')
    .attr('viewBox', `0 0 ${W} ${H}`)
    .attr('preserveAspectRatio', 'xMidYMid meet');

  // Zoom
  const zoomBehavior = d3.zoom()
    .scaleExtent([0.4, 3])
    .on('zoom', (e) => g.attr('transform', e.transform));
  svg.call(zoomBehavior);

  document.getElementById('zoomIn').onclick = () => svg.transition().duration(300).call(zoomBehavior.scaleBy, 1.3);
  document.getElementById('zoomOut').onclick = () => svg.transition().duration(300).call(zoomBehavior.scaleBy, 0.7);
  document.getElementById('zoomReset').onclick = () => svg.transition().duration(500).call(zoomBehavior.transform, d3.zoomIdentity);

  // Defs — glow filters
  const defs = svg.append('defs');
  const colors = {blue:'#3b82f6',cyan:'#06b6d4',violet:'#8b5cf6',amber:'#f59e0b'};
  Object.entries(colors).forEach(([name, col]) => {
    const f = defs.append('filter').attr('id', `glow-${name}`).attr('x','-50%').attr('y','-50%').attr('width','200%').attr('height','200%');
    f.append('feGaussianBlur').attr('in','SourceGraphic').attr('stdDeviation','4').attr('result','blur');
    f.append('feFlood').attr('flood-color',col).attr('flood-opacity','0.4').attr('result','color');
    f.append('feComposite').attr('in','color').attr('in2','blur').attr('operator','in').attr('result','glow');
    const m = f.append('feMerge');
    m.append('feMergeNode').attr('in','glow');
    m.append('feMergeNode').attr('in','SourceGraphic');
  });

  const g = svg.append('g');

  // Layout config
  const nodeW = 114, nodeH = 42, gapX = 10, gapY = 14;
  const tierPad = 16;
  const examBarH = 36;
  const cols = 8; // modules per row

  // Group modules by level
  const levelGroups = {1:[],2:[],3:[],4:[]};
  modules.forEach(m => levelGroups[m.level].push(m));

  // Calculate positions using snake layout
  const nodePositions = [];
  let yOffset = 20;
  const tierBands = [];
  const examGates = [];
  const levelColorMap = {1:'blue',2:'cyan',3:'violet',4:'amber'};

  [1,2,3,4].forEach((lvl, li) => {
    const mods = levelGroups[lvl];
    const lc = levelConfig[lvl];
    const color = lc.color;
    const colorName = levelColorMap[lvl];
    const rows = Math.ceil(mods.length / cols);
    const bandStartY = yOffset;

    mods.forEach((mod, mi) => {
      const row = Math.floor(mi / cols);
      const colIdx = mi % cols;
      const isReversed = row % 2 === 1;
      const actualCol = isReversed ? (cols - 1 - colIdx) : colIdx;

      const x = tierPad + actualCol * (nodeW + gapX) + nodeW / 2;
      const y = yOffset + tierPad + row * (nodeH + gapY) + nodeH / 2;

      nodePositions.push({mod, x, y, level: lvl, color, colorName, seqInLevel: mi});
    });

    const bandH = rows * (nodeH + gapY) - gapY + tierPad * 2;
    tierBands.push({y: bandStartY, h: bandH, color, colorName, label: `${lc.name} — ${lc.label}`, level: lvl});
    yOffset += bandH;

    // Add exam gate between levels (not after the last)
    if (lvl < 4) {
      examGates.push({y: yOffset, exam: lc.exam, name: lc.name, color, colorName});
      yOffset += examBarH;
    }
  });

  // Final badge area
  const finalBadgeY = yOffset + 20;
  const totalH = finalBadgeY + 60;
  svg.attr('viewBox', `0 0 ${W} ${totalH}`);

  // Draw tier bands
  tierBands.forEach(tb => {
    g.append('rect')
      .attr('x', 0).attr('y', tb.y)
      .attr('width', W).attr('height', tb.h)
      .attr('fill', tb.color).attr('opacity', 0.04)
      .attr('rx', 6);

    // Tier label (left edge)
    g.append('text')
      .attr('x', 8).attr('y', tb.y + 14)
      .attr('font-family', "'JetBrains Mono', monospace")
      .attr('font-size', 9).attr('fill', tb.color)
      .attr('opacity', 0.5).attr('font-weight', 600)
      .attr('letter-spacing', '1.5px')
      .text(tb.label.toUpperCase());
  });

  // Draw exam gates
  examGates.forEach(eg => {
    const gateG = g.append('g');
    gateG.append('rect')
      .attr('x', 0).attr('y', eg.y)
      .attr('width', W).attr('height', examBarH)
      .attr('fill', '#0a0c12').attr('stroke', eg.color)
      .attr('stroke-opacity', 0.2).attr('rx', 0);

    // Dashed line accents
    gateG.append('line')
      .attr('x1', 20).attr('y1', eg.y + examBarH / 2)
      .attr('x2', W / 2 - 180).attr('y2', eg.y + examBarH / 2)
      .attr('stroke', eg.color).attr('stroke-opacity', 0.15)
      .attr('stroke-width', 1).attr('stroke-dasharray', '4,4');

    gateG.append('line')
      .attr('x1', W / 2 + 180).attr('y1', eg.y + examBarH / 2)
      .attr('x2', W - 20).attr('y2', eg.y + examBarH / 2)
      .attr('stroke', eg.color).attr('stroke-opacity', 0.15)
      .attr('stroke-width', 1).attr('stroke-dasharray', '4,4');

    // Lock icon
    gateG.append('text')
      .attr('x', W / 2 - 170).attr('y', eg.y + examBarH / 2 + 4)
      .attr('font-size', 12).attr('fill', eg.color).attr('opacity', 0.6)
      .attr('text-anchor', 'middle')
      .text('\u{1F512}');

    // Exam text
    gateG.append('text')
      .attr('x', W / 2).attr('y', eg.y + examBarH / 2 + 4)
      .attr('font-family', "'JetBrains Mono', monospace")
      .attr('font-size', 10).attr('fill', eg.color)
      .attr('text-anchor', 'middle').attr('font-weight', 600)
      .attr('letter-spacing', '0.5px')
      .text(`${eg.name} Exam  \u00B7  ${eg.exam}`);
  });

  // Draw connection lines
  for (let i = 1; i < nodePositions.length; i++) {
    const prev = nodePositions[i - 1];
    const curr = nodePositions[i];

    // Only connect within same level or across levels
    if (prev.level === curr.level) {
      // Same level connections
      const prevRow = Math.floor(prev.seqInLevel / cols);
      const currRow = Math.floor(curr.seqInLevel / cols);

      if (prevRow === currRow) {
        // Same row — horizontal line
        const x1 = prev.x + nodeW / 2;
        const x2 = curr.x - nodeW / 2;
        g.append('line')
          .attr('x1', Math.min(prev.x + nodeW/2, curr.x + nodeW/2))
          .attr('y1', prev.y)
          .attr('x2', Math.max(prev.x - nodeW/2, curr.x - nodeW/2))
          .attr('y2', curr.y)
          .attr('stroke', prev.color).attr('stroke-opacity', 0.2)
          .attr('stroke-width', 1.5);
      } else {
        // Row transition — vertical drop (snake turn)
        // prev is last in its row, curr is first in next row (but they share the same column due to snake)
        const midY = (prev.y + curr.y) / 2;
        const path = d3.path();
        path.moveTo(prev.x, prev.y + nodeH / 2);
        path.lineTo(prev.x, midY);
        path.lineTo(curr.x, midY);
        path.lineTo(curr.x, curr.y - nodeH / 2);
        g.append('path')
          .attr('d', path.toString())
          .attr('fill', 'none')
          .attr('stroke', prev.color).attr('stroke-opacity', 0.2)
          .attr('stroke-width', 1.5);
      }
    } else {
      // Cross-tier connection (through exam gate)
      const path = d3.path();
      path.moveTo(prev.x, prev.y + nodeH / 2);
      const midY = (prev.y + nodeH / 2 + curr.y - nodeH / 2) / 2;
      path.bezierCurveTo(
        prev.x, midY,
        curr.x, midY,
        curr.x, curr.y - nodeH / 2
      );
      g.append('path')
        .attr('d', path.toString())
        .attr('fill', 'none')
        .attr('stroke', curr.color).attr('stroke-opacity', 0.15)
        .attr('stroke-width', 1.5)
        .attr('stroke-dasharray', '6,4');
    }
  }

  // Draw module nodes
  nodePositions.forEach(np => {
    const nodeG = g.append('g')
      .attr('class', 'module-node')
      .attr('transform', `translate(${np.x - nodeW/2}, ${np.y - nodeH/2})`)
      .style('cursor', 'pointer')
      .on('click', () => openDetail(np.mod))
      .on('mouseenter', function() {
        d3.select(this).select('rect')
          .transition().duration(200)
          .attr('stroke-opacity', 0.8)
          .attr('filter', `url(#glow-${np.colorName})`);
        d3.select(this)
          .transition().duration(200)
          .attr('transform', `translate(${np.x - nodeW/2 - 2}, ${np.y - nodeH/2 - 2}) scale(1.04)`);
      })
      .on('mouseleave', function() {
        d3.select(this).select('rect')
          .transition().duration(200)
          .attr('stroke-opacity', 0.35)
          .attr('filter', null);
        d3.select(this)
          .transition().duration(200)
          .attr('transform', `translate(${np.x - nodeW/2}, ${np.y - nodeH/2}) scale(1)`);
      });

    nodeG.append('rect')
      .attr('width', nodeW).attr('height', nodeH)
      .attr('rx', 7).attr('ry', 7)
      .attr('fill', np.color).attr('fill-opacity', 0.1)
      .attr('stroke', np.color).attr('stroke-opacity', 0.35)
      .attr('stroke-width', 1.2);

    nodeG.append('text')
      .attr('x', nodeW / 2).attr('y', 16)
      .attr('text-anchor', 'middle')
      .attr('font-family', "'JetBrains Mono', monospace")
      .attr('font-size', 9).attr('font-weight', 700)
      .attr('fill', np.color)
      .text(np.mod.id);

    // Truncate short title if too long
    let shortText = np.mod.short;
    if (shortText.length > 16) shortText = shortText.substring(0, 15) + '..';

    nodeG.append('text')
      .attr('x', nodeW / 2).attr('y', 32)
      .attr('text-anchor', 'middle')
      .attr('font-family', "'Outfit', sans-serif")
      .attr('font-size', 8).attr('font-weight', 500)
      .attr('fill', '#8b90a0')
      .text(shortText);
  });

  // Final PAKA badge
  const badgeG = g.append('g')
    .attr('transform', `translate(${W/2}, ${finalBadgeY})`);

  // Glow circle behind badge
  badgeG.append('circle')
    .attr('r', 28)
    .attr('fill', '#f59e0b').attr('fill-opacity', 0.08)
    .attr('stroke', '#f59e0b').attr('stroke-opacity', 0.3)
    .attr('stroke-width', 2);

  badgeG.append('circle')
    .attr('r', 20)
    .attr('fill', '#f59e0b').attr('fill-opacity', 0.15)
    .attr('stroke', '#f59e0b').attr('stroke-opacity', 0.5)
    .attr('stroke-width', 1.5);

  badgeG.append('text')
    .attr('y', 1)
    .attr('text-anchor', 'middle')
    .attr('dominant-baseline', 'middle')
    .attr('font-family', "'JetBrains Mono', monospace")
    .attr('font-size', 9).attr('font-weight', 800)
    .attr('fill', '#f59e0b')
    .attr('letter-spacing', '1px')
    .text('PAKA');

  badgeG.append('text')
    .attr('y', 42)
    .attr('text-anchor', 'middle')
    .attr('font-family', "'Outfit', sans-serif")
    .attr('font-size', 10).attr('font-weight', 600)
    .attr('fill', '#555a6e')
    .text('Payment Architect Certification');

  // Animate badge glow
  badgeG.select('circle:first-child')
    .append('animate')
    .attr('attributeName', 'r')
    .attr('values', '28;32;28')
    .attr('dur', '3s')
    .attr('repeatCount', 'indefinite');
}

// Render tree on initial load
document.addEventListener('DOMContentLoaded', () => {
  setTimeout(renderTree, 100);
});
</script>
</body>
</html>